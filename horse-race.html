<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üêé Horse Race</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#1b5e20;color:#fff}
.stage{
  background:url("images/bg/sky.png") top/cover no-repeat,
             url("images/bg/grass.png") bottom/cover no-repeat;
  min-height:100vh;
}

/* HEADER */
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 14px;font-size:20px;font-weight:bold
}
.wallet{background:rgba(0,0,0,.35);padding:6px 14px;border-radius:20px}

/* TIMER */
.timer-box{
  display:flex;justify-content:center;align-items:center;
  font-size:22px;font-weight:bold;margin-top:4px
}
.timer-box img{width:30px;margin-right:6px}
.bet-close{text-align:center;color:#ffeb3b;font-size:14px;height:18px}

/* BET PANEL */
.bet-panel{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:10px}
.horse-card{
  background:#0f8a70;border-radius:10px;padding:8px;
  display:flex;align-items:center;gap:8px;position:relative;
  cursor:pointer
}
.horse-card.active{outline:3px solid gold}
.horse-card img{width:46px}
.bet-badge{
  position:absolute;top:-6px;right:-6px;
  background:#ffeb3b;color:#000;
  padding:2px 6px;border-radius:12px;
  font-size:12px;font-weight:bold
}

/* TRACK */
.track{margin:10px}
.lane{
  height:42px;position:relative;
  border-bottom:2px solid rgba(255,255,255,.35);
  background:rgba(139,69,19,.25);margin-bottom:6px
}
.lane img{
  width:36px;position:absolute;left:0;bottom:2px;
  transition:left .08s linear
}

/* CHIPS */
.chips{display:flex;justify-content:center;gap:10px;padding:10px}
.chip{
  background:#fff;color:#000;padding:10px;border-radius:50%;
  font-weight:bold;cursor:pointer
}
.chip.active{background:gold}

/* POPUP */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;z-index:99
}
.popup{
  padding:22px 28px;border-radius:16px;text-align:center
}
.popup.win{background:#2e7d32}
.popup.lose{background:#b71c1c}
</style>
</head>

<body>
<div class="stage">

<div class="header">
 üêé Horse Race
 <div class="wallet">‚Çπ <span id="wallet">400</span></div>
</div>

<div class="timer-box">
 <img src="images/ui/timer.png">
 <span id="time">15</span>s
</div>
<div class="bet-close" id="betClose"></div>

<div class="bet-panel" id="betPanel"></div>
<div class="track" id="track"></div>

<div class="chips">
 <div class="chip" data-amt="10">10</div>
 <div class="chip" data-amt="50">50</div>
 <div class="chip" data-amt="100">100</div>
 <div class="chip" data-amt="500">500</div>
</div>

</div>

<div class="overlay" id="overlay">
 <div class="popup" id="popup"><h2 id="popupText"></h2></div>
</div>

<script>
/* DATA */
const horses=[
 {id:1,odds:8.6},{id:2,odds:6.5},{id:3,odds:4.7},
 {id:4,odds:6.8},{id:5,odds:9.7},{id:6,odds:3.9}
];

let selectedChip=0;
let time=15;
let betting=true;
let timerInterval=null;

let balance=Number(localStorage.getItem("wallet")||400);
let horseBets={};

const walletEl=document.getElementById("wallet");
walletEl.innerText=balance;

/* BUILD UI */
function buildRound(){
 betPanel.innerHTML="";
 track.innerHTML="";
 horseBets={};
 betting=true;
 betClose.innerText="";

 horses.forEach(h=>{
  horseBets[h.id]=0;

  const card=document.createElement("div");
  card.className="horse-card";
  card.innerHTML=`
    <img src="images/horses/horse${h.id}.png">
    <div><b>Horse ${h.id}</b><div>Odds ${h.odds}</div></div>
  `;

  card.onclick=()=>{
    if(!betting || !selectedChip) return;
    if(balance < selectedChip) return alert("Low Balance");

    balance -= selectedChip;
    horseBets[h.id] += selectedChip;
    walletEl.innerText=balance;
    localStorage.setItem("wallet",balance);

    card.classList.add("active");
    let badge=card.querySelector(".bet-badge");
    if(!badge){
      badge=document.createElement("div");
      badge.className="bet-badge";
      card.appendChild(badge);
    }
    badge.innerText="‚Çπ"+horseBets[h.id];
  };

  betPanel.appendChild(card);

  const lane=document.createElement("div");
  lane.className="lane";
  lane.innerHTML=`<img id="horse${h.id}" src="images/horses/horse${h.id}.png">`;
  track.appendChild(lane);
 });
}

/* CHIPS */
document.querySelectorAll(".chip").forEach(c=>{
 c.onclick=()=>{
  document.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
  c.classList.add("active");
  selectedChip=+c.dataset.amt;
 };
});

/* TIMER (100% FIXED) */
function startTimer(){
 clearInterval(timerInterval);
 time=15;
 betting=true;
 timeEl.innerText=time;

 timerInterval=setInterval(()=>{
  time--;
  timeEl.innerText=time;

  if(time<=3){
    betting=false;
    betClose.innerText="Bet Closed";
  }
  if(time<=0){
    clearInterval(timerInterval);
    startRace();
  }
 },1000);
}

/* RACE */
function startRace(){
 let pos={};
 horses.forEach(h=>pos[h.id]=0);

 const race=setInterval(()=>{
  horses.forEach(h=>{
   pos[h.id]+=Math.random()*3.2;
   document.getElementById("horse"+h.id).style.left=pos[h.id]+"%";
   if(pos[h.id]>=90){
    clearInterval(race);
    finishRace(h.id);
   }
  });
 },60);
}

/* FINISH */
function finishRace(winId){
 overlay.style.display="flex";

 const horse=horses.find(h=>h.id===winId);
 const winAmount=horseBets[winId]*horse.odds;

 if(winAmount>0){
  balance+=winAmount;
  popup.className="popup win";
  popupText.innerText="üéâ You Win ‚Çπ"+winAmount.toFixed(2);
 }else{
  popup.className="popup lose";
  popupText.innerText="‚ùå You Lose";
 }

 localStorage.setItem("wallet",balance);
 walletEl.innerText=balance;

 setTimeout(()=>{
  overlay.style.display="none";
  buildRound();
  startTimer();
 },2000);
}

/* START */
buildRound();
startTimer();
</script>
</body>
</html>
