<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:#fff}
.header{display:flex;justify-content:space-between;align-items:center;padding:14px;background:#111}
.logo{font-size:26px;font-weight:bold;color:#ff1744}
.balance{font-size:18px;color:#00e676}
.history{display:flex;gap:10px;padding:10px;overflow-x:auto;background:#0f0f0f}
.history span{font-size:14px}
.low{color:#64b5f6}
.mid{color:#00e676}
.high{color:#e040fb}
.game{height:40vh;background:radial-gradient(circle at bottom,#1a1a1a,#000);display:flex;align-items:center;justify-content:center}
.multiplier{text-align:center;font-size:64px;font-weight:bold}
.crashed{color:#ff5252}
.status{text-align:center;padding:8px;color:#aaa;font-size:16px}
.controls{padding:12px;display:flex;flex-direction:column;gap:12px}
.betbox{background:#151515;border-radius:14px;padding:12px}
.row{display:flex;gap:8px;margin-bottom:8px}
input{flex:1;padding:10px;border:none;border-radius:8px;font-size:16px;text-align:center}
button{flex:1;padding:10px;border:none;border-radius:8px;font-weight:bold;font-size:16px}
.gray{background:#333;color:#fff}
.green{background:#2ecc71;color:#000}
.locked{opacity:.5;pointer-events:none}
.popup-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999}
.popup{background:#1c1c1c;padding:20px 26px;border-radius:14px;font-size:20px;font-weight:bold}
.win{color:#2ecc71}
.loss{color:#ff5252}
.betp{color:#64b5f6}
</style>
</head>

<body>

<div class="header">
  <div class="logo">Aviator</div>
  <div class="balance">â‚¹ <span id="wallet">3000</span></div>
</div>

<div class="history" id="history"></div>

<div class="game">
  <div class="multiplier" id="multi">WAITING</div>
</div>

<div class="status" id="status"></div>

<div class="controls">

  <div class="betbox" id="box1">
    <div class="row">
      <button class="gray" onclick="chg(1,-1)">-</button>
      <input id="amt1" value="10">
      <button class="gray" onclick="chg(1,1)">+</button>
    </div>
    <div class="row">
      <button class="gray" onclick="setAmt(1,1)">1</button>
      <button class="gray" onclick="setAmt(1,2)">2</button>
      <button class="gray" onclick="setAmt(1,5)">5</button>
      <button class="gray" onclick="setAmt(1,10)">10</button>
    </div>
    <button class="green" id="btn1" onclick="bet(1)">BET</button>
  </div>

  <div class="betbox" id="box2">
    <div class="row">
      <button class="gray" onclick="chg(2,-1)">-</button>
      <input id="amt2" value="1">
      <button class="gray" onclick="chg(2,1)">+</button>
    </div>
    <div class="row">
      <button class="gray" onclick="setAmt(2,1)">1</button>
      <button class="gray" onclick="setAmt(2,2)">2</button>
      <button class="gray" onclick="setAmt(2,5)">5</button>
      <button class="gray" onclick="setAmt(2,10)">10</button>
    </div>
    <button class="green" id="btn2" onclick="bet(2)">BET</button>
  </div>

</div>

<div class="popup-bg" id="popupBg">
  <div class="popup" id="popup"></div>
</div>

<!-- ðŸ”¥ FIREBASE WALLET CONNECT (NO GAME CODE TOUCHED) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e"
});

const db = getFirestore(app);
const email = localStorage.getItem("userEmail");
let uid="";

/* LOAD WALLET */
(async()=>{
  if(!email) return;
  const q=query(collection(db,"users"),where("email","==",email));
  const s=await getDocs(q);
  s.forEach(d=>{
    uid=d.id;
    wallet=d.data().balance||0;
    document.getElementById("wallet").innerText=wallet;
  });
})();

/* WRAP BET FUNCTION (SAFE) */
const _bet = window.bet;
window.bet = async function(n){
  const before = wallet;
  _bet(n);
  if(wallet!==before && uid){
    await updateDoc(doc(db,"users",uid),{balance:wallet});
  }
};
</script>

</body>
</html>
