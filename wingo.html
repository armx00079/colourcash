<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WIN GO</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.header{text-align:center;padding:15px;font-size:22px}
.top{display:flex;justify-content:space-between;padding:0 15px;color:#bbb}
.timer{text-align:center;font-size:34px;color:#ff4081;margin:10px}
.card{background:#1c1c1c;margin:15px;padding:15px;border-radius:12px}
input{width:100%;padding:12px;font-size:18px;border-radius:8px;border:none;text-align:center}
.grid3,.grid5{display:grid;gap:8px;margin-top:10px}
.grid3{grid-template-columns:repeat(3,1fr)}
.grid5{grid-template-columns:repeat(5,1fr)}
.btn{padding:14px;border:none;border-radius:10px;font-weight:bold;color:#fff}
.red{background:#e53935}
.green{background:#43a047}
.violet{background:#8e24aa}
.dark{background:#333}
.multi{background:#eee;color:#000}
.multi.active{background:#43a047;color:#fff}
.bigsmall{display:flex;margin-top:10px}
.bigsmall button{flex:1;padding:12px;border:none;font-size:16px}
.big{background:#f4a261}
.small{background:#4dabf7}
.tabs{display:flex;gap:10px;margin:15px}
.tab{flex:1;padding:12px;border-radius:10px;text-align:center;font-weight:bold}
.active{background:#ff6f6f}
.inactive{background:#333}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;text-align:center}
th{background:#ff6f6f}
.win{color:#4caf50}
.loss{color:#f44336}
.lock{pointer-events:none;opacity:.4}

.popup-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.65);
  display:none;align-items:center;justify-content:center;z-index:9999
}
.popup{
  background:#1c1c1c;border-radius:16px;padding:22px;
  text-align:center;width:80%;max-width:320px
}
.popup.win{border:2px solid #4caf50}
.popup.loss{border:2px solid #f44336}
.popup.bet{border:2px solid #2196f3}
</style>
</head>

<body>

<div class="header">üé® WIN GO</div>

<div class="top">
  <div>Period: <span id="period"></span></div>
  <div>Wallet: ‚Çπ<span id="wallet"></span></div>
</div>

<div class="timer">‚è≥ <span id="time"></span>s</div>

<div class="card" id="betBox">
  <input id="amount" type="number" placeholder="Min ‚Çπ1">

  <div class="grid3">
    <button class="btn red" onclick="bet('color','RED')">RED</button>
    <button class="btn green" onclick="bet('color','GREEN')">GREEN</button>
    <button class="btn violet" onclick="bet('color','VIOLET')">VIOLET</button>
  </div>

  <div class="grid5">
    <button class="btn dark" onclick="bet('number',0)">0</button>
    <button class="btn dark" onclick="bet('number',1)">1</button>
    <button class="btn dark" onclick="bet('number',2)">2</button>
    <button class="btn dark" onclick="bet('number',3)">3</button>
    <button class="btn dark" onclick="bet('number',4)">4</button>
    <button class="btn dark" onclick="bet('number',5)">5</button>
    <button class="btn dark" onclick="bet('number',6)">6</button>
    <button class="btn dark" onclick="bet('number',7)">7</button>
    <button class="btn dark" onclick="bet('number',8)">8</button>
    <button class="btn dark" onclick="bet('number',9)">9</button>
  </div>

  <div class="grid5">
    <button class="multi active" onclick="setMulti(1,this)">X1</button>
    <button class="multi" onclick="setMulti(5,this)">X5</button>
    <button class="multi" onclick="setMulti(10,this)">X10</button>
    <button class="multi" onclick="setMulti(20,this)">X20</button>
    <button class="multi" onclick="setMulti(50,this)">X50</button>
  </div>

  <div class="bigsmall">
    <button class="big" onclick="bet('bs','BIG')">Big</button>
    <button class="small" onclick="bet('bs','SMALL')">Small</button>
  </div>
</div>

<div class="popup-overlay" id="popupOverlay">
  <div class="popup" id="popupBox"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, onSnapshot,
  getDocs, collection, query, where, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

const userEmail = localStorage.getItem("userEmail");
let userDocId="";
let wallet=0;
let locked=false;
let multi=1;

const $=id=>document.getElementById(id);

/* LOAD USER WALLET */
const snap = await getDocs(query(collection(db,"users"),where("email","==",userEmail)));
snap.forEach(d=>{ userDocId=d.id; wallet=d.data().balance||0 });
walletEl();

/* LIVE ROUND SYNC */
onSnapshot(doc(db,"wingo_round","current"), snap=>{
 const d=snap.data();
 if(!d) return;

 period.innerText=d.period;

 const now=Date.now();
 let t=Math.floor((d.betEnd-now)/1000);
 if(t<0) t=0;

 time.innerText=t;
 locked = t<=5;
 betBox.className=locked?"card lock":"card";

 if(d.number!==undefined){
   showPopup("win",`<h2>RESULT</h2><p>${d.number} ${d.color}</p>`);
 }
});

/* BET */
window.bet=async(type,val)=>{
 if(locked) return;
 let amt=+amount.value;
 if(amt<1||amt>wallet) return;

 wallet-=amt;
 await updateDoc(doc(db,"users",userDocId),{balance:wallet});
 walletEl();
 showPopup("bet","<h2>Bet Placed</h2>");
};

window.setMulti=(x,e)=>{
 multi=x;
 document.querySelectorAll('.multi').forEach(b=>b.classList.remove('active'));
 e.classList.add('active');
};

function walletEl(){ wallet.innerText=wallet; }

function showPopup(type,msg){
 popupBox.className="popup "+type;
 popupBox.innerHTML=msg;
 popupOverlay.style.display="flex";
 setTimeout(()=>popupOverlay.style.display="none",1500);
}
</script>

</body>
</html>
