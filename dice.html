<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dice Roll</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#0b1c2d,#020814);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.game{
  width:320px;
  text-align:center;
}
.wallet{
  position:absolute;
  top:12px;
  right:12px;
  background:#000;
  padding:8px 14px;
  border-radius:20px;
  font-weight:bold;
}
.dice{
  font-size:90px;
  margin:20px 0;
}
input{
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:10px;
  border:none;
  text-align:center;
}
button{
  margin-top:15px;
  width:100%;
  padding:14px;
  font-size:18px;
  border:none;
  border-radius:14px;
  background:#ffb703;
  font-weight:bold;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#ffb703;
  color:#000;
  padding:30px 40px;
  border-radius:20px;
  font-size:26px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="wallet">ðŸ’° â‚¹<span id="walletAmt">0</span></div>

<div class="game">
  <h2>DICE ROLL</h2>
  <div class="dice" id="dice">ðŸŽ²</div>
  <input type="number" id="betAmt" placeholder="Enter Bet Amount">
  <button onclick="rollDice()">ROLL DICE</button>
</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== FIREBASE CONFIG (TERA) ===== */
const firebaseConfig = {
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e",
  storageBucket: "colourcash-ea60e.firebasestorage.app",
  messagingSenderId: "403688058646",
  appId: "1:403688058646:web:f1753360471528f275ea37"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== USER INFO ===== */
const userEmail = "samxj525@gmail.com";   // demo
let wallet = 0;
let userDocId = "";

/* ===== LOAD WALLET ===== */
async function loadWallet(){
  const q = query(collection(db,"users"), where("email","==",userEmail));
  const snap = await getDocs(q);

  snap.forEach(d=>{
    userDocId = d.id;
    wallet = d.data().balance || 0;
    walletAmt.innerText = wallet;
  });
}

/* ===== UPDATE WALLET ===== */
async function updateWallet(){
  if(!userDocId) return;
  await updateDoc(collection(db,"users").doc(userDocId), {
    balance: wallet
  });
}

/* ===== GAME LOGIC ===== */
window.rollDice = async function(){
  const bet = parseInt(betAmt.value);
  if(!bet || bet<=0) return alert("Enter bet");
  if(bet > wallet) return alert("Insufficient balance");

  wallet -= bet;
  walletAmt.innerText = wallet;
  await updateWallet();

  const dice = Math.floor(Math.random()*6)+1;
  document.getElementById("dice").innerText = dice;

  let win = false;
  if(dice >= 4){ // WIN CONDITION
    wallet += bet * 2;
    win = true;
  }

  walletAmt.innerText = wallet;
  await updateWallet();

  popupText.innerText = win ? "ðŸŽ‰ YOU WIN" : "âŒ YOU LOST";
  popup.style.display = "flex";

  setTimeout(()=>popup.style.display="none",2000);
};

loadWallet();
</script>

</body>
</html>
