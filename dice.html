<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DICE ROLL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle at top,#0b1c2d,#030b14);
  color:#fff;
  text-align:center;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  font-weight:bold;
}
.wallet{
  background:rgba(0,0,0,.5);
  padding:6px 14px;
  border-radius:20px;
}
.dice{
  font-size:90px;
  margin:20px 0;
  transition:transform .3s;
}
.roll{ transform:rotate(360deg) scale(1.2); }

input{
  width:80%;
  padding:14px;
  border-radius:30px;
  border:none;
  margin-bottom:14px;
  font-size:16px;
}

/* ODD EVEN */
.odd-even{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-bottom:14px;
}
.oe-btn{
  flex:1;
  max-width:140px;
  padding:12px 0;
  border-radius:20px;
  border:none;
  background:#1e2a3a;
  color:#fff;
  font-weight:bold;
}
.oe-btn.active{
  background:#ffb300;
  color:#000;
  transform:scale(1.05);
}

button{
  width:80%;
  padding:14px;
  border-radius:30px;
  border:none;
  background:#ffb300;
  font-size:18px;
  font-weight:bold;
}

/* HISTORY */
.my-history{
  margin:16px;
  background:rgba(0,0,0,.35);
  border-radius:12px;
  padding:10px;
  text-align:left;
  font-size:13px;
}
.my-history h3{
  margin:0 0 6px;
  text-align:center;
}
.bet-row{
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid rgba(255,255,255,.1);
  padding:6px 0;
}
.win{ color:#4caf50; }
.lose{ color:#ff5252; }

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#ffb300;
  color:#000;
  padding:24px 40px;
  border-radius:20px;
  font-size:22px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <div>DICE ROLL</div>
  <div class="wallet">â‚¹ <span id="wallet">0</span></div>
</div>

<div class="dice" id="dice">ðŸŽ²</div>

<div class="odd-even">
  <button class="oe-btn" id="oddBtn">ODD<br><small>1 Â· 3 Â· 5</small></button>
  <button class="oe-btn" id="evenBtn">EVEN<br><small>2 Â· 4 Â· 6</small></button>
</div>

<input type="number" id="bet" value="100">
<button id="roll">ROLL DICE</button>

<div class="my-history">
  <h3>MY BETS HISTORY</h3>
  <div id="betHistory"></div>
</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”¥ FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

const userEmail = localStorage.getItem("userEmail");
let wallet = 0;
let uid = "";

/* LOAD WALLET */
async function loadWallet(){
  const q = query(collection(db,"users"), where("email","==",userEmail));
  const snap = await getDocs(q);
  snap.forEach(d=>{
    uid = d.id;
    wallet = Number(d.data().balance || 0);
  });
  updateWallet();
}

/* SAVE WALLET */
async function saveWallet(){
  if(!uid) return;
  await updateDoc(doc(db,"users",uid), { balance: wallet });
}

/* ðŸŽ¯ HOUSE EDGE CONTROL */
function getWinChance(bet){
  if(bet <= 50)  return 0.40;
  if(bet <= 200) return 0.32;
  if(bet <= 500) return 0.25;
  if(bet <= 1000) return 0.18;
  return 0.12;
}

/* GAME */
const dice = document.getElementById("dice");
const rollBtn = document.getElementById("roll");
const betInp = document.getElementById("bet");
const popup = document.getElementById("popup");
const popupText = document.getElementById("popupText");
const betHistory = document.getElementById("betHistory");

let selectedOE="";

/* SELECT */
oddBtn.onclick=()=>{
  selectedOE="odd";
  oddBtn.classList.add("active");
  evenBtn.classList.remove("active");
};
evenBtn.onclick=()=>{
  selectedOE="even";
  evenBtn.classList.add("active");
  oddBtn.classList.remove("active");
};

/* ROLL */
rollBtn.onclick = async ()=>{
  const bet = Number(betInp.value);
  if(!selectedOE) return alert("Select ODD or EVEN");
  if(bet<=0 || bet>wallet) return alert("Low balance");

  wallet -= bet;
  await saveWallet();
  updateWallet();

  dice.classList.add("roll");

  setTimeout(async ()=>{
    dice.classList.remove("roll");

    const winChance = getWinChance(bet);
    const willWin = Math.random() < winChance;

    let num, win=false;

    if(willWin){
      num = selectedOE==="odd"
        ? [1,3,5][Math.floor(Math.random()*3)]
        : [2,4,6][Math.floor(Math.random()*3)];
      win=true;
    }else{
      num = selectedOE==="odd"
        ? [2,4,6][Math.floor(Math.random()*3)]
        : [1,3,5][Math.floor(Math.random()*3)];
    }

    let winAmt=0;
    if(win){
      winAmt = bet*2;
      wallet += winAmt;
      popupText.innerText=`ðŸŽ‰ YOU WIN â‚¹${winAmt}`;
      await saveWallet();
    }else{
      popupText.innerText="âŒ YOU LOST";
    }

    updateWallet();
    addHistory(num,bet,selectedOE,win,winAmt);
    popup.style.display="flex";
    setTimeout(()=>popup.style.display="none",1500);
  },600);
};

function updateWallet(){
  document.getElementById("wallet").innerText=wallet;
}

/* HISTORY */
function addHistory(num,bet,oe,win,amt){
  const div=document.createElement("div");
  div.className="bet-row";
  div.innerHTML=`
    <span>ðŸŽ² ${num} (${oe.toUpperCase()})</span>
    <span class="${win?'win':'lose'}">
      ${win?`+â‚¹${amt}`:`-â‚¹${bet}`}
    </span>`;
  betHistory.prepend(div);
}

loadWallet();
</script>

</body>
</html>
