<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HILO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#ffd56a,#f2b705);
  text-align:center;
  color:#000;
}
.header{padding:14px;font-size:26px;font-weight:bold}
.history{font-size:14px;opacity:.8;margin-top:6px}

.card-area{display:flex;justify-content:center;gap:40px;margin-top:30px}
.card{
  width:110px;height:150px;border-radius:14px;background:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:48px;font-weight:bold;
  box-shadow:0 6px 14px rgba(0,0,0,.25)
}
.deck{width:110px;height:150px;border-radius:14px;background:#1e3a8a}

.refresh{margin-top:8px;font-size:18px;cursor:pointer}

.multi{margin:18px 0;font-size:20px;font-weight:bold}

.controls{display:flex;justify-content:center;gap:16px;margin-bottom:14px}
.ctrl{
  padding:14px 26px;border-radius:26px;
  background:#000;color:#fff;font-weight:bold;cursor:pointer
}

.bet-row{display:flex;justify-content:center;gap:10px}
.bet-btn{
  padding:12px 18px;background:#000;color:#fff;
  border-radius:20px;font-weight:bold;cursor:pointer
}

.cashout{
  margin-top:14px;padding:14px 60px;
  background:#16a34a;color:#fff;
  border-radius:30px;font-size:18px;font-weight:bold;cursor:pointer
}

#wallet{
  position:fixed;bottom:12px;right:12px;
  background:#000;color:#fff;
  padding:10px 18px;border-radius:22px;font-weight:bold
}

.popup{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center
}
.popup-box{
  background:#fff;padding:30px 50px;
  border-radius:20px;font-size:26px;font-weight:bold
}
.win{color:#16a34a}
.loss{color:#dc2626}
</style>
</head>

<body>

<div class="header">
 üÉè HILO
 <div class="history" id="history">History: -</div>
</div>

<div class="card-area">
 <div>
   <div class="card" id="currentCard">?</div>
   <div class="refresh" id="refresh">üîÑ</div>
 </div>
 <div class="deck"></div>
</div>

<div class="multi">Multiplier: <span id="multi">1.10x</span></div>

<div class="controls">
 <div class="ctrl" id="low">‚¨á LOW</div>
 <div class="ctrl" id="high">‚¨Ü HIGH</div>
</div>

<div class="bet-row">
 <div class="bet-btn" id="minus">-</div>
 <div class="bet-btn" id="betText">Bet ‚Çπ10</div>
 <div class="bet-btn" id="plus">+</div>
</div>

<div class="cashout" id="cashout">CASHOUT</div>

<div id="wallet">üí∞ ‚Çπ<span id="bal">0</span></div>

<div class="popup" id="popup">
 <div class="popup-box" id="popupBox"></div>
</div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, query, where,
  getDocs, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
 authDomain:"colourcash-ea60e.firebaseapp.com",
 projectId:"colourcash-ea60e",
 storageBucket:"colourcash-ea60e.firebasestorage.app",
 messagingSenderId:"403688058646",
 appId:"1:403688058646:web:f1753360471528f275ea37"
});
const db = getFirestore(app);

/* ‚úÖ WALLET FIX (EMAIL BASED ‚Äì SAME AS KENO) */
const email = localStorage.getItem("userEmail");
const bal = document.getElementById("bal");
let uid="", balance=0;

async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
   uid=d.id;
   balance=Number(d.data().balance||0);
 });
 bal.innerText=balance;
}
loadWallet();

/* GAME DATA */
const cards=["2","3","4","5","6","7","8","9","10","J","Q","K","A"];
let currentIndex=Math.floor(Math.random()*cards.length);
let bet=10;
let step=0;
let multipliers=[1.10,1.25,1.45,1.70,2.00,2.40,2.90];
let history=[];

const currentCard=document.getElementById("currentCard");
const multi=document.getElementById("multi");
const historyBox=document.getElementById("history");

function render(){
 currentCard.innerText=cards[currentIndex];
 multi.innerText=multipliers[step].toFixed(2)+"x";
 historyBox.innerText="History: "+(history.join(" ‚Üí ")||"-");
}
render();

/* REFRESH */
refresh.onclick=()=>{
 if(step>0) return;
 currentIndex=Math.floor(Math.random()*cards.length);
 render();
};

/* BET */
minus.onclick=()=>{ if(bet>10){bet-=10;betText.innerText="Bet ‚Çπ"+bet;} }
plus.onclick=()=>{ bet+=10;betText.innerText="Bet ‚Çπ"+bet; }

/* PLAY */
async function play(isHigh){
 if(balance<bet) return;

 balance-=bet;
 bal.innerText=balance;
 await updateDoc(doc(db,"users",uid),{balance});

 const next=Math.floor(Math.random()*cards.length);
 const win=isHigh? next>currentIndex : next<currentIndex;

 if(win){
  step++;
  history.push(cards[currentIndex]);
  currentIndex=next;
  render();
 }else{
  showPopup("YOU LOSE",false);
  reset();
 }
}

high.onclick=()=>play(true);
low.onclick=()=>play(false);

/* CASHOUT */
cashout.onclick=async ()=>{
 if(step===0) return;
 const winAmt=Math.floor(bet*multipliers[step]);
 balance+=winAmt;
 bal.innerText=balance;
 await updateDoc(doc(db,"users",uid),{balance});
 showPopup("YOU WIN ‚Çπ"+winAmt,true);
 reset();
};

/* RESET */
function reset(){
 step=0;
 history=[];
 currentIndex=Math.floor(Math.random()*cards.length);
 setTimeout(render,400);
}

/* POPUP */
function showPopup(t,w){
 popup.style.display="flex";
 popupBox.className="popup-box "+(w?"win":"loss");
 popupBox.innerText=t;
 setTimeout(()=>popup.style.display="none",2000);
}
</script>

</body>
</html>
