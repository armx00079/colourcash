<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HILO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(180deg,#ffd56a,#ffb300);
  text-align:center;
  color:#000;
}
h1{margin:14px 0}

/* WALLET */
#wallet{
 position:fixed;
 right:12px;
 bottom:12px;
 background:#000;
 color:#fff;
 padding:10px 18px;
 border-radius:22px;
 font-weight:bold;
}

/* CARD */
.card-box{
 margin:30px auto 10px;
 width:120px;
 height:160px;
 background:#fff;
 border-radius:14px;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:46px;
 font-weight:bold;
 box-shadow:0 10px 25px rgba(0,0,0,.25);
}
.card-red{color:#e53935}
.card-black{color:#000}

/* MULTI */
.multi{
 font-size:18px;
 margin:10px 0;
 font-weight:bold;
}

/* CONTROLS */
.controls{
 display:flex;
 justify-content:center;
 gap:16px;
 margin:16px 0;
}
.ctrl{
 padding:14px 26px;
 border-radius:28px;
 background:#000;
 color:#fff;
 font-weight:bold;
 cursor:pointer;
}

/* BET */
.bet-row{
 display:flex;
 justify-content:center;
 gap:10px;
 margin:14px 0;
}
.btn{
 background:#000;
 color:#fff;
 padding:10px 18px;
 border-radius:18px;
 font-weight:bold;
 cursor:pointer;
}

/* POPUP */
.popup{
 position:fixed;inset:0;
 background:rgba(0,0,0,.6);
 display:none;
 align-items:center;justify-content:center;
}
.popup .box{
 padding:30px 50px;
 border-radius:20px;
 font-size:26px;
 font-weight:bold;
}
.win{background:#4caf50;color:#000}
.loss{background:#b00020;color:#fff}
</style>
</head>

<body>

<h1>üÉè HILO</h1>

<div class="card-box" id="card">A</div>
<div class="multi">Multiplier: <span id="multi">1.00x</span></div>

<div class="controls">
 <div class="ctrl" id="low">‚¨á LOW</div>
 <div class="ctrl" id="high">‚¨Ü HIGH</div>
</div>

<div class="bet-row">
 <div class="btn" id="minus">-</div>
 <div class="btn" id="bet">Bet ‚Çπ10</div>
 <div class="btn" id="plus">+</div>
</div>

<div class="btn" id="cashout" style="display:none;background:#4caf50">CASHOUT</div>

<div id="wallet">üí∞ ‚Çπ<span id="bal">0</span></div>

<div class="popup" id="popup">
 <div class="box" id="popupBox"></div>
</div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• FIREBASE CONFIG (TERA WALA) */
const app = initializeApp({
 apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
 authDomain:"colourcash-ea60e.firebaseapp.com",
 projectId:"colourcash-ea60e",
 storageBucket:"colourcash-ea60e.firebasestorage.app",
 messagingSenderId:"403688058646",
 appId:"1:403688058646:web:f1753360471528f275ea37"
});
const db = getFirestore(app);

const email = localStorage.getItem("userEmail");
let uid="", balance=0;

/* WALLET LOAD */
async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const s=await getDocs(q);
 s.forEach(d=>{uid=d.id;balance=Number(d.data().balance||0);});
 bal.innerText=balance;
}
function userRef(){return doc(db,"users",uid);}
loadWallet();

/* CARDS */
const cards=[
 {n:"A",v:14},{n:"K",v:13},{n:"Q",v:12},{n:"J",v:11},
 {n:"10",v:10},{n:"9",v:9},{n:"8",v:8},{n:"7",v:7},
 {n:"6",v:6},{n:"5",v:5},{n:"4",v:4},{n:"3",v:3},{n:"2",v:2}
];

let current = cards[Math.floor(Math.random()*cards.length)];
let bet=10;
let step=0;
let multiplier=1.0;
let playing=false;

let games = Number(localStorage.getItem("H_GAMES")||0);

/* UI */
const cardEl=document.getElementById("card");
const multiEl=document.getElementById("multi");
cardEl.innerText=current.n;

/* BET */
minus.onclick=()=>{ if(bet>10){bet-=10;betBtn()} }
plus.onclick=()=>{ bet+=10;betBtn() }
function betBtn(){ betBtnEl.innerText="Bet ‚Çπ"+bet }
const betBtnEl=document.getElementById("bet");

/* GAME LOGIC */
async function guess(type){
 if(playing) return;
 if(balance<bet && step===0) return;

 if(step===0){
  balance-=bet;
  bal.innerText=balance;
  await updateDoc(userRef(),{balance});
 }

 playing=true;

 let next = cards[Math.floor(Math.random()*cards.length)];
 let win=false;

 if(type==="high" && next.v>current.v) win=true;
 if(type==="low" && next.v<current.v) win=true;

 /* FIRST GAME GUARANTEE */
 games++;
 localStorage.setItem("H_GAMES",games);
 if((games===1 || games===3) && win){
   win=true;
 }

 setTimeout(async ()=>{
  cardEl.innerText=next.n;
  current=next;

  if(win){
    step++;
    multiplier = +(multiplier + 0.5).toFixed(2);
    multiEl.innerText=multiplier+"x";
    document.getElementById("cashout").style.display="inline-block";
    playing=false;
  }else{
    showPopup("YOU LOSE","loss");
    resetGame();
  }
 },600);
}

high.onclick=()=>guess("high");
low.onclick=()=>guess("low");

/* CASHOUT */
cashout.onclick=async ()=>{
 let winAmt=Math.min(bet*multiplier,200);
 balance+=winAmt;
 bal.innerText=balance;
 await updateDoc(userRef(),{balance});
 showPopup("WIN ‚Çπ"+winAmt,"win");
 resetGame();
};

/* RESET */
function resetGame(){
 step=0;
 multiplier=1;
 multiEl.innerText="1.00x";
 document.getElementById("cashout").style.display="none";
 playing=false;
 current = cards[Math.floor(Math.random()*cards.length)];
 cardEl.innerText=current.n;
}

/* POPUP */
function showPopup(t,c){
 popupBox.className="box "+c;
 popupBox.innerText=t;
 popup.style.display="flex";
 setTimeout(()=>popup.style.display="none",1800);
}
</script>

</body>
</html>
