<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel ‚Äì Colour Cash</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
header{
  background:linear-gradient(135deg,#ff6a6a,#ff8e8e);
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:bold
}
.dashboard{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  padding:15px
}
.d-card{
  background:#1c1c1c;
  border-radius:14px;
  padding:14px;
  text-align:center
}
.d-card h2{margin:0;font-size:22px;color:#ff8e8e}
.d-card span{font-size:12px;color:#aaa}

.tabs{display:flex;background:#111}
.tab{
  flex:1;padding:14px;text-align:center;
  cursor:pointer;color:#aaa;font-weight:bold
}
.tab.active{background:#1c1c1c;color:#ff8e8e}

.section{display:none;padding:15px}
.section.active{display:block}

.tools{display:flex;gap:10px;margin-bottom:12px}
.tools input,.tools select{
  flex:1;padding:10px;border-radius:10px;border:none
}

.card{
  background:#1c1c1c;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px
}
.row{display:flex;justify-content:space-between;font-size:14px;margin:6px 0}

.btn{
  padding:10px 14px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  margin-top:10px;
  cursor:pointer
}
.approve{background:#2e7d32;color:#fff}
.reject{background:#c62828;color:#fff}
.view{background:#2196f3;color:#fff}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999
}
.modal-box{
  background:#1c1c1c;
  width:90%;
  max-width:420px;
  border-radius:16px;
  padding:18px
}
.modal-box button{width:100%}

@media(max-width:600px){
  .dashboard{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>üõ†Ô∏è Colour Cash ‚Äì Admin Panel</header>

<div class="dashboard">
  <div class="d-card"><h2 id="totalUsers">0</h2><span>Total Users</span></div>
  <div class="d-card"><h2 id="pendingDeposits">0</h2><span>Pending Deposits</span></div>
  <div class="d-card"><h2 id="pendingWithdraws">0</h2><span>Pending Withdraws</span></div>
</div>

<div class="tabs">
  <div class="tab active" onclick="openTab(0)">Deposits</div>
  <div class="tab" onclick="openTab(1)">Withdraws</div>
  <div class="tab" onclick="openTab(2)">Users</div>
</div>

<div class="section active" id="sec0"></div>
<div class="section" id="sec1"></div>
<div class="section" id="sec2"></div>

<div class="modal" id="modal">
  <div class="modal-box" id="modalBox"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

window.openTab=i=>{
  document.querySelectorAll(".tab").forEach((t,n)=>t.classList.toggle("active",n===i));
  document.querySelectorAll(".section").forEach((s,n)=>s.classList.toggle("active",n===i));
};

async function loadDashboard(){
  const users=await getDocs(collection(db,"users"));
  const dep=await getDocs(collection(db,"deposits"));
  const wd=await getDocs(collection(db,"withdraws"));

  totalUsers.innerText=users.size;
  pendingDeposits.innerText=dep.docs.filter(d=>d.data().status==="PENDING").length;
  pendingWithdraws.innerText=wd.docs.filter(d=>d.data().status==="PENDING").length;
}

/* ===== DEPOSITS ===== */
async function loadDeposits(){
  const box=sec0;
  const snap=await getDocs(collection(db,"deposits"));
  box.innerHTML="";
  snap.forEach(d=>{
    const x=d.data();
    if(x.status!=="PENDING")return;
    box.innerHTML+=`
      <div class="card">
        <div class="row"><span>${x.email}</span><span>‚Çπ${x.amount}</span></div>
        <div class="row"><span>UTR</span><span>${x.utr}</span></div>
        <button class="btn approve" onclick="approveDeposit('${d.id}','${x.email}',${x.amount})">Approve</button>
        <button class="btn reject" onclick="rejectDeposit('${d.id}')">Reject</button>
      </div>`;
  });
}

window.approveDeposit=async(id,email,amt)=>{
  await updateDoc(doc(db,"deposits",id),{status:"APPROVED"});
  const u=await getDocs(collection(db,"users"));
  u.forEach(async d=>{
    if(d.data().email===email){
      await updateDoc(doc(db,"users",d.id),{
        balance:(d.data().balance||0)+amt
      });
    }
  });
  loadDeposits();loadDashboard();
};

window.rejectDeposit=async id=>{
  await updateDoc(doc(db,"deposits",id),{status:"REJECTED"});
  loadDeposits();loadDashboard();
};

/* ===== WITHDRAWS ===== */
async function loadWithdraws(){
  const box=sec1;
  const snap=await getDocs(collection(db,"withdraws"));
  box.innerHTML="";
  snap.forEach(d=>{
    const w=d.data();
    if(w.status!=="PENDING")return;
    box.innerHTML+=`
      <div class="card">
        <div class="row"><span>${w.email}</span><span>‚Çπ${w.amount}</span></div>
        <button class="btn view" onclick='viewWithdraw("${d.id}",${JSON.stringify(w)})'>View</button>
      </div>`;
  });
}

window.viewWithdraw=(id,w)=>{
  modalBox.innerHTML=`
    <h3>Withdraw Detail</h3>
    <p>${w.email}</p>
    <p>‚Çπ${w.amount}</p>
    ${w.method==="UPI"
      ? `<p>UPI: ${w.upiId}</p>`
      : `<p>${w.bankDetails.holder}<br>${w.bankDetails.bank}<br>${w.bankDetails.account}<br>${w.bankDetails.ifsc}</p>`}
    <button class="btn approve" onclick="approveWithdraw('${id}')">Approve</button>
    <button class="btn reject" onclick="rejectWithdraw('${id}')">Reject</button>
    <button class="btn view" onclick="closeModal()">Close</button>`;
  modal.style.display="flex";
};

window.approveWithdraw=async id=>{
  await updateDoc(doc(db,"withdraws",id),{status:"APPROVED"});
  closeModal();loadWithdraws();loadDashboard();
};
window.rejectWithdraw=async id=>{
  await updateDoc(doc(db,"withdraws",id),{status:"REJECTED"});
  closeModal();loadWithdraws();loadDashboard();
};
window.closeModal=()=>modal.style.display="none";

/* ===== USERS ===== */
async function loadUsers(){
  const box=sec2;
  const snap=await getDocs(collection(db,"users"));
  box.innerHTML="";
  snap.forEach(d=>{
    const u=d.data();
    box.innerHTML+=`
      <div class="card">
        <div class="row"><span>${u.email}</span><span>‚Çπ${u.balance||0}</span></div>
      </div>`;
  });
}

loadDashboard();
loadDeposits();
loadWithdraws();
loadUsers();
</script>

</body>
</html>
