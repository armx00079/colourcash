<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GANESH SLOTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:url("images/bg/bg-main.jpg") center/cover no-repeat,
             radial-gradient(circle,#3b0a0a,#140404);
  color:#fff;
  text-align:center;
}
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px;font-weight:bold
}
.wallet{
  background:rgba(0,0,0,.5);
  padding:6px 14px;border-radius:20px
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;padding:20px
}
.cell{
  background:rgba(0,0,0,.55);
  border-radius:16px;height:90px;
  display:flex;align-items:center;justify-content:center
}
.cell img{max-width:70px}
.bet-box{
  display:flex;justify-content:center;align-items:center;
  gap:14px;margin-top:8px
}
.bet-box button{
  width:44px;height:44px;border-radius:50%;
  font-size:22px;cursor:pointer;border:none
}
.spin-btn{
  margin:16px auto;width:180px;padding:14px;
  border-radius:40px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  font-size:22px;font-weight:bold;border:none;
  color:#fff;cursor:pointer
}
.history{
  margin:16px;background:rgba(0,0,0,.4);
  border-radius:12px;padding:10px;font-size:13px
}
.h-row{display:flex;justify-content:space-between;padding:6px 0}
.win{color:#4caf50}.lose{color:#ff5252}.free{color:#ffeb3b}

/* POPUP */
.popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;z-index:99
}
.popup-box{
  background:#222;padding:26px 40px;
  border-radius:20px;font-size:22px;font-weight:bold
}
.popup-box.win{color:#4caf50}
.popup-box.lose{color:#ff5252}
.popup-box.free{color:#ffeb3b}
</style>
</head>

<body>

<div class="header">
  <div>üïâÔ∏è GANESH SLOTS</div>
  <div class="wallet">‚Çπ <span id="wallet">0</span></div>
</div>

<div class="grid" id="grid"></div>

<div>3 Scatter = üéÅ 10 Free Spins</div>

<div class="bet-box">
  <button id="minusBtn">‚àí</button>
  Bet ‚Çπ <span id="bet">10</span>
  <button id="plusBtn">+</button>
</div>

<button class="spin-btn" id="spinBtn">SPIN</button>

<div class="history">
  <h3>MY BETS</h3>
  <div id="history"></div>
</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupBox"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db=getFirestore(app);

const email=localStorage.getItem("userEmail");
let uid="", balance=0;

/* SYMBOLS */
const symbols={
 diya:{img:"images/symbols/diya.png"},
 flower:{img:"images/symbols/flower.png"},
 coin:{img:"images/symbols/coin.png"},
 wild:{img:"images/symbols/wild.png"},
 scatter:{img:"images/symbols/scatter.png"}
};

let bet=10, freeSpins=0;

/* ELEMENTS */
const grid=document.getElementById("grid");
const walletEl=document.getElementById("wallet");
const betEl=document.getElementById("bet");
const historyBox=document.getElementById("history");
const popup=document.getElementById("popup");
const popupBox=document.getElementById("popupBox");

/* USER REF */
function userRef(){return doc(db,"users",uid);}

/* LOAD WALLET */
async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
  uid=d.id;
  balance=Number(d.data().balance||0);
 });
 walletEl.innerText=balance;
}

/* GRID */
function buildGrid(res){
 grid.innerHTML="";
 res.forEach(s=>{
  const d=document.createElement("div");
  d.className="cell";
  if(s){
    const img=document.createElement("img");
    img.src=s.img;
    d.appendChild(img);
  }
  grid.appendChild(d);
 });
}

/* BET */
plusBtn.onclick=()=>{bet+=10;betEl.innerText=bet};
minusBtn.onclick=()=>{bet=Math.max(10,bet-10);betEl.innerText=bet};

/* SMART PAYOUT */
function getSmartPayout(bet){
 const r=Math.random();
 if(bet<=10){
  if(r<0.4) return 0;
  if(r<0.55) return 3;
  if(r<0.7) return 4;
  if(r<0.85) return 5;
  return 10;
 }
 if(bet<=100){
  if(r<0.45) return 0;
  if(r<0.6) return 20;
  if(r<0.75) return 35;
  if(r<0.85) return 40;
  return 100;
 }
 if(r<0.5) return 0;
 if(r<0.7) return 100;
 if(r<0.85) return 430;
 return bet;
}

/* POPUP */
function showPopup(text,cls){
 popupBox.className="popup-box "+cls;
 popupBox.innerText=text;
 popup.style.display="flex";
 setTimeout(()=>popup.style.display="none",1600);
}

/* HISTORY */
function addHistory(t,a,c){
 const r=document.createElement("div");
 r.className="h-row";
 r.innerHTML=`<span>${t}</span><span class="${c}">${a}</span>`;
 historyBox.prepend(r);
}

/* SPIN */
spinBtn.onclick=async ()=>{
 if(freeSpins<=0){
  if(balance<bet) return alert("Low balance");
  balance-=bet;
  await updateDoc(userRef(),{balance});
 }

 const keys=Object.keys(symbols);
 let result=[], scat=0;
 for(let i=0;i<9;i++){
  let k=keys[Math.floor(Math.random()*keys.length)];
  if(k==="scatter") scat++;
  result.push({name:k,img:symbols[k].img});
 }
 buildGrid(result);

 if(scat>=3 && freeSpins===0){
  freeSpins=10;
  addHistory("FREE SPINS","+10","free");
  showPopup("üéÅ 10 FREE SPINS","free");
 }

 let payout=0;
 [[0,1,2],[3,4,5],[6,7,8]].forEach(r=>{
  const a=result[r[0]],b=result[r[1]],c=result[r[2]];
  if(a.name===b.name && b.name===c.name && a.name!=="scatter"){
    payout=Math.max(payout,getSmartPayout(bet));
  }
 });

 if(payout>0){
  balance+=payout;
  await updateDoc(userRef(),{balance});
  addHistory("WIN","+‚Çπ"+payout,"win");
  showPopup("üéâ YOU WIN ‚Çπ"+payout,"win");
 }else{
  addHistory("LOSE","-‚Çπ"+bet,"lose");
  showPopup("‚ùå YOU LOSE","lose");
 }

 if(freeSpins>0) freeSpins--;
 walletEl.innerText=balance;
};

/* START */
buildGrid(Array(9).fill(null));
loadWallet();
</script>

</body>
</html>
