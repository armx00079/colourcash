<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GANESH SLOTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle,#3b0a0a,#140404);
  color:#fff;
  text-align:center;
}
.header{
  display:flex;
  justify-content:space-between;
  padding:14px;
  font-weight:bold;
}
.wallet{
  background:rgba(0,0,0,.5);
  padding:6px 14px;
  border-radius:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  padding:20px;
}
.cell{
  background:rgba(0,0,0,.55);
  border-radius:16px;
  height:90px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.cell img{max-width:70px}
.bet-box{
  display:flex;
  justify-content:center;
  gap:14px;
}
.bet-box button{
  width:44px;height:44px;
  border-radius:50%;
  font-size:22px;
}
.spin-btn{
  margin:16px auto;
  width:180px;
  padding:14px;
  border-radius:40px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  font-size:22px;
  font-weight:bold;
  border:none;
  color:#fff;
}
.history{
  margin:16px;
  background:rgba(0,0,0,.4);
  border-radius:12px;
  padding:10px;
  font-size:13px;
}
.h-row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
}
.win{color:#4caf50}
.lose{color:#ff5252}
.free{color:#ffeb3b}
</style>
</head>

<body>

<div class="header">
  <div>üïâÔ∏è GANESH SLOTS</div>
  <div class="wallet">‚Çπ <span id="wallet">0</span></div>
</div>

<div class="grid" id="grid"></div>

<div>3 Scatter = üéÅ 5 Free Spins</div>

<div class="bet-box">
  <button id="minus">‚àí</button>
  Bet ‚Çπ <span id="bet">10</span>
  <button id="plus">+</button>
</div>

<button class="spin-btn" id="spin">SPIN</button>

<div class="history">
  <h3>MY BETS</h3>
  <div id="history"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db=getFirestore(app);

const email=localStorage.getItem("userEmail");
let uid="", balance=0;

const symbols=[
 {n:"coin",i:"images/symbols/coin.png",m:3.5},
 {n:"wild",i:"images/symbols/wild.png",m:6.0},
 {n:"diya",i:"images/symbols/diya.png",m:1.5},
 {n:"flower",i:"images/symbols/flower.png",m:2.2},
 {n:"scatter",i:"images/symbols/scatter.png",m:0}
];

let bet=10;
let freeSpins=0;
let spinCount=0, winCount=0;

const grid=document.getElementById("grid");
const walletEl=wallet;
const betEl=bet;
const historyBox=history;

function userRef(){return doc(db,"users",uid);}

async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
  uid=d.id;
  balance=Number(d.data().balance||0);
 });
 walletEl.innerText=balance;
}

function buildGrid(res){
 grid.innerHTML="";
 res.forEach(s=>{
  const d=document.createElement("div");
  d.className="cell";
  const img=document.createElement("img");
  img.src=s.i;
  d.appendChild(img);
  grid.appendChild(d);
 });
}

function addHistory(t,amt,cls){
 const r=document.createElement("div");
 r.className="h-row";
 r.innerHTML=`<span>${t}</span><span class="${cls}">${amt}</span>`;
 historyBox.prepend(r);
}

function canWin(){
 spinCount++;
 if(spinCount>10){spinCount=1;winCount=0;}
 if(winCount>=4) return false;
 return true;
}

spin.onclick=async ()=>{
 if(freeSpins<=0){
  if(balance<bet) return alert("Low balance");
  balance-=bet;
  await updateDoc(userRef(),{balance});
 }
 walletEl.innerText=balance;

 let res=[];
 for(let i=0;i<9;i++){
  res.push(symbols[Math.floor(Math.random()*symbols.length)]);
 }
 buildGrid(res);

 // scatter logic
 const scat=res.filter(x=>x.n==="scatter").length;
 if(scat>=3 && freeSpins===0){
  freeSpins=5;
  addHistory("FREE SPINS","+5","free");
 }

 // row check
 let winAmt=0;
 const rows=[[0,1,2],[3,4,5],[6,7,8]];
 rows.forEach(r=>{
  const a=res[r[0]],b=res[r[1]],c=res[r[2]];
  if(a.n===b.n && b.n===c.n && a.n!=="scatter" && canWin()){
    winAmt=Math.max(winAmt, bet*a.m);
  }
 });

 if(winAmt>0){
  balance+=winAmt;
  winCount++;
  await updateDoc(userRef(),{balance});
  addHistory("WIN","+‚Çπ"+winAmt.toFixed(2),"win");
 }else{
  addHistory("LOSE","-‚Çπ"+bet,"lose");
 }

 if(freeSpins>0) freeSpins--;
 walletEl.innerText=balance;
};

plus.onclick=()=>{bet+=10;betEl.innerText=bet;}
minus.onclick=()=>{bet=Math.max(10,bet-10);betEl.innerText=bet;}

loadWallet();
buildGrid(Array(9).fill(symbols[0]));
</script>

</body>
</html>
