<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GANESH SLOTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:url("images/bg/bg-main.jpg") center/cover no-repeat,
             radial-gradient(circle,#3b0a0a,#140404);
  color:#fff;
  text-align:center;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  font-weight:bold;
}
.wallet{
  background:rgba(0,0,0,.5);
  padding:6px 14px;
  border-radius:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  padding:20px;
}
.cell{
  background:rgba(0,0,0,.55);
  border-radius:16px;
  height:90px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.cell img{max-width:70px}
.bet-box{
  display:flex;
  justify-content:center;
  gap:14px;
}
.bet-box button{
  width:44px;height:44px;
  border-radius:50%;
  font-size:22px;
}
.spin-btn{
  margin:16px auto;
  width:180px;
  padding:14px;
  border-radius:40px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  font-size:22px;
  font-weight:bold;
  border:none;
  color:#fff;
}
.history{
  margin:16px;
  background:rgba(0,0,0,.4);
  border-radius:12px;
  padding:10px;
  font-size:13px;
}
.h-row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
}
.win{color:#4caf50}
.lose{color:#ff5252}
.free{color:#ffeb3b}
</style>
</head>

<body>

<div class="header">
  <div>üïâÔ∏è GANESH SLOTS</div>
  <div class="wallet">‚Çπ <span id="wallet">0</span></div>
</div>

<div class="grid" id="grid"></div>

<div>3 Scatter = üéÅ 10 Free Spins</div>

<div class="bet-box">
  <button id="minusBtn">‚àí</button>
  Bet ‚Çπ <span id="bet">10</span>
  <button id="plusBtn">+</button>
</div>

<button class="spin-btn" id="spinBtn">SPIN</button>

<div class="history">
  <h3>MY BETS</h3>
  <div id="history"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db=getFirestore(app);

const email=localStorage.getItem("userEmail");
let uid="", balance=0;

/* SYMBOLS */
const symbols={
 diya:{img:"images/symbols/diya.png",multi:1.5},
 flower:{img:"images/symbols/flower.png",multi:2.2},
 coin:{img:"images/symbols/coin.png",multi:3.5},
 wild:{img:"images/symbols/wild.png",multi:6.0},
 scatter:{img:"images/symbols/scatter.png",multi:0}
};

let bet=10;
let freeSpins=0;
let spinCount=0, winCount=0;

/* ELEMENTS */
const grid=document.getElementById("grid");
const walletEl=wallet;
const betEl=bet;
const historyBox=history;

function userRef(){return doc(db,"users",uid);}

/* LOAD WALLET */
async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
  uid=d.id;
  balance=Number(d.data().balance||0);
 });
 walletEl.innerText=balance;
}

/* GRID */
function buildGrid(res){
 grid.innerHTML="";
 res.forEach(s=>{
  const d=document.createElement("div");
  d.className="cell";
  const img=document.createElement("img");
  img.src=s.img;
  d.appendChild(img);
  grid.appendChild(d);
 });
}

/* BET */
plusBtn.onclick=()=>{bet+=10;betEl.innerText=bet;}
minusBtn.onclick=()=>{bet=Math.max(10,bet-10);betEl.innerText=bet;}

/* RISK */
function allowWin(){
 spinCount++;
 if(spinCount>10){spinCount=1;winCount=0;}
 if(winCount>=4) return false;

 let risk=bet/Math.max(balance,1);
 let chance=0.35;
 if(risk>0.3) chance=0.22;
 if(risk>0.5) chance=0.12;

 const w=Math.random()<chance;
 if(w) winCount++;
 return w;
}

/* SPIN */
spinBtn.onclick=async ()=>{
 if(freeSpins<=0){
  if(balance<bet) return alert("Low balance");
  balance-=bet;
  await updateDoc(userRef(),{balance});
 }

 let result=[];
 let scatCount=0;

 for(let i=0;i<9;i++){
  let keys=Object.keys(symbols);
  let k=keys[Math.floor(Math.random()*keys.length)];
  if(k==="scatter") scatCount++;
  result.push({name:k,...symbols[k]});
 }

 buildGrid(result);

 /* SCATTER */
 if(scatCount>=3 && freeSpins===0){
  freeSpins=10;
  addHistory("FREE SPINS","+10","free");
 }

 /* ROW WIN CHECK */
 let winAmt=0;
 const rows=[[0,1,2],[3,4,5],[6,7,8]];
 rows.forEach(r=>{
  const a=result[r[0]],b=result[r[1]],c=result[r[2]];
  if(a.name===b.name && b.name===c.name && a.name!=="scatter" && allowWin()){
    winAmt=Math.max(winAmt, bet*a.multi);
  }
 });

 if(winAmt>0){
  balance+=winAmt;
  await updateDoc(userRef(),{balance});
  addHistory("WIN","+‚Çπ"+winAmt.toFixed(2),"win");
 }else{
  addHistory("LOSE","-‚Çπ"+bet,"lose");
 }

 if(freeSpins>0) freeSpins--;
 walletEl.innerText=balance;
};

/* HISTORY */
function addHistory(t,amt,cls){
 const r=document.createElement("div");
 r.className="h-row";
 r.innerHTML=`<span>${t}</span><span class="${cls}">${amt}</span>`;
 historyBox.prepend(r);
}

/* START */
buildGrid(Array(9).fill({img:""}));
loadWallet();
</script>

</body>
</html>
