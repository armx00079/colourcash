else{
      if(state.phase==="BET"){state.phase="LOCK";state.time=5}
      else if(state.phase==="LOCK"){resolve()}
      else{
        state.period++;
        state.phase="BET";
        state.time=25;
        state.selected=null;
        godCard.innerText="GOD";
        devilCard.innerText="DEVIL";
      }
    }
    save();render();
  },1000);
}

/* -------- ACTIONS -------- */
function selectBet(s){
  if(state.phase!=="BET")return;
  state.selected=s;
  render();
}

function placeBet(){
  let amt=+amount.value;
  if(!state.selectedamt<1amt>state.wallet)return;
  state.wallet-=amt;
  state.bets.unshift({p:state.period,side:state.selected,amt,res:"PENDING"});
  popup("Bet Placed");
  save();render();
}

function resolve(){
  state.phase="RESULT";
  state.time=5;

  let g=cards[Math.random()*cards.length|0];
  let d=cards[Math.random()*cards.length|0];

  godCard.innerText=g;
  devilCard.innerText=d;
  godCard.classList.add("flip");
  devilCard.classList.add("flip");

  let gv=cards.indexOf(g), dv=cards.indexOf(d);
  let result = gv<dv?"GOD":dv<gv?"DEVIL":"DRAW";

  state.last10.unshift({p:state.period,r:result});
  state.last10=state.last10.slice(0,10);

  state.bets.forEach(b=>{
    if(b.p===state.period && b.res==="PENDING"){
      if(b.side===result){
        let win=b.amt*2;
        state.wallet+=win;
        b.res="WIN ₹"+win;
        popup("YOU WIN ₹"+win);
      }else{
        b.res="LOSS";
        popup("YOU LOST");
      }
    }
  });
}

/* -------- INIT -------- */
render();
startLoop();
</script>

</body>
  </html>
