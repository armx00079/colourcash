<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wallet ‚Äì Colour Cash</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f2f2f2;
  color:#222;
  padding-bottom:90px;
}
.header{
  background:linear-gradient(135deg,#ff6a6a,#ff8e8e);
  color:#fff;
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}
.wallet-card{
  background:linear-gradient(135deg,#ff6a6a,#ff8e8e);
  color:#fff;
  margin:15px;
  border-radius:16px;
  padding:20px;
  text-align:center;
}
.wallet-card h1{
  margin:10px 0 4px;
  font-size:34px;
}
.wallet-card p{
  margin:0;
  opacity:0.9;
  font-size:14px;
}
.stats{
  display:flex;
  justify-content:space-between;
  margin-top:15px;
}
.stat{
  flex:1;
  text-align:center;
}
.stat h3{
  margin:0;
  font-size:18px;
}
.stat span{
  font-size:12px;
  opacity:0.9;
}
.actions{
  background:#fff;
  margin:15px;
  border-radius:16px;
  padding:15px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
.action{
  text-align:center;
  font-size:13px;
  cursor:pointer;
}
.action div{
  width:44px;
  height:44px;
  margin:auto;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  margin-bottom:6px;
}
.deposit{background:#ffe0b2}
.withdraw{background:#e1bee7}
.dh{background:#bbdefb}
.wh{background:#ffcdd2}
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#111;
  display:flex;
  border-top:1px solid #222;
  z-index:9999;
}
.nav-btn{
  flex:1;
  padding:10px 0;
  text-align:center;
  font-size:12px;
  color:#aaa;
}
.nav-btn.active{
  color:#ff6a6a;
  font-weight:bold;
}
.nav-btn div{font-size:20px}
</style>
</head>

<body>

<div class="header">Wallet</div>

<div class="wallet-card">
  <p>Total Balance</p>
  <h1>‚Çπ<span id="balance">0.00</span></h1>

  <div class="stats">
    <div class="stat">
      <h3 id="withdrawTotal">0</h3>
      <span>Total Withdraw</span>
    </div>
    <div class="stat">
      <h3 id="depositTotal">0</h3>
      <span>Total Deposit</span>
    </div>
  </div>
</div>

<div class="actions">
  <div class="action" onclick="location.href='deposit.html'">
    <div class="deposit">üí∞</div>
    Deposit
  </div>
  <div class="action" onclick="location.href='withdraw.html'">
    <div class="withdraw">üè¶</div>
    Withdraw
  </div>
  <div class="action" onclick="location.href='deposit-history.html'">
    <div class="dh">üì•</div>
    Deposit History
  </div>
  <div class="action" onclick="location.href='withdraw-history.html'">
    <div class="wh">üì§</div>
    Withdraw History
  </div>
</div>

<div class="bottom-nav">
  <div class="nav-btn" onclick="location.href='index.html'">
    <div>üè†</div>Home
  </div>
  <div class="nav-btn active">
    <div>üí∞</div>Wallet
  </div>
  <div class="nav-btn" onclick="location.href='promotion.html'">
    <div>üéÅ</div>Promotion
  </div>
  <div class="nav-btn" onclick="location.href='account.html'">
    <div>üë§</div>Account
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const userEmail = localStorage.getItem("userEmail");

async function loadWallet(){
  let balance = 0;
  let totalDeposit = 0;
  let totalWithdraw = 0;

  /* USER BALANCE */
  const userSnap = await getDocs(
    query(collection(db,"users"), where("email","==",userEmail))
  );
  userSnap.forEach(d=>{
    balance = d.data().balance || 0;
  });

  /* DEPOSITS */
  const depSnap = await getDocs(
    query(collection(db,"deposits"), where("email","==",userEmail))
  );
  depSnap.forEach(d=>{
    const x=d.data();
    if(x.status==="APPROVED"){
      totalDeposit += Number(x.amount);
    }
  });

  /* ‚úÖ WITHDRAWS (üî• FIXED ‚Äì FIRESTORE) */
  const wdSnap = await getDocs(
    query(collection(db,"withdraws"), where("email","==",userEmail))
  );
  wdSnap.forEach(d=>{
    const w=d.data();
    if(w.status==="APPROVED"){
      totalWithdraw += Number(w.amount);
    }
  });

  document.getElementById("balance").innerText = balance.toFixed(2);
  document.getElementById("depositTotal").innerText = totalDeposit;
  document.getElementById("withdrawTotal").innerText = totalWithdraw;
}

loadWallet();
</script>

</body>
</html>
