<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deposit â€“ Colour Cash</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#0f0f0f;color:#fff}
.header{padding:15px;font-size:22px;font-weight:bold;text-align:center}
.card{background:#1b1b1b;margin:15px;border-radius:16px;padding:18px}
label{font-size:14px;color:#ccc}
input{width:100%;padding:14px;border-radius:10px;border:none;margin-top:8px;font-size:16px}
.upi-box{background:#000;padding:14px;border-radius:12px;text-align:center;font-size:18px;margin-top:12px}
.copy-btn{width:100%;margin-top:10px;padding:14px;background:#2196f3;border:none;border-radius:10px;color:#fff;font-size:16px;font-weight:bold}
.note{margin-top:10px;font-size:13px;color:#fbc02d;text-align:center}
.submit{width:100%;margin-top:15px;padding:14px;background:#4caf50;border:none;border-radius:10px;color:#fff;font-size:17px;font-weight:bold}
.qr-box{background:#fff;border-radius:12px;padding:12px;text-align:center;margin-top:12px}
.qr-box img{width:180px}
.apps{display:flex;gap:10px;margin-top:15px}
.app-btn{flex:1;padding:12px;border-radius:10px;font-weight:bold;border:none}
.gpay{background:#fff;color:#000}
.phonepe{background:#6739b7;color:#fff}
.paytm{background:#00baf2;color:#000}
.popup-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999}
.popup{background:#1c1c1c;padding:22px;border-radius:16px;width:85%;text-align:center}
.popup h3{margin:0 0 8px;color:#4caf50}
.popup p{font-size:14px;color:#ccc}
.popup button{margin-top:15px;padding:12px;width:100%;background:#4caf50;border:none;border-radius:10px;color:#fff;font-size:16px}
</style>
</head>

<body>

<div class="header">ðŸ’° Deposit</div>

<div class="card">
<label>Enter Amount (â‚¹)</label>
<input type="number" id="amount" placeholder="Minimum â‚¹100" min="100">

<div class="upi-box">vs197053@okicici</div>
<button class="copy-btn" onclick="copyUPI()">Copy UPI ID</button>

<div class="qr-box">
<img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=upi://pay?pa=vs197053@okicici&pn=ColourCash">
</div>

<div class="note">Pay to above UPI ID or scan QR, then enter UTR number below</div>

<div class="apps">
<button class="app-btn gpay" onclick="pay()">GPay</button>
<button class="app-btn phonepe" onclick="pay()">PhonePe</button>
<button class="app-btn paytm" onclick="pay()">Paytm</button>
</div>

<label style="margin-top:14px;display:block">Enter UTR Number</label>
<input type="number" id="utr" placeholder="12 digit UTR number">

<button class="submit" onclick="submitDeposit()">Submit Deposit</button>
</div>

<div class="popup-bg" id="popupBg">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <p id="popupMsg"></p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<!-- UI SCRIPT -->
<script>
const UPI="vs197053@okicici";
const popupBg=document.getElementById("popupBg");
const popupTitle=document.getElementById("popupTitle");
const popupMsg=document.getElementById("popupMsg");
const amount=document.getElementById("amount");
const utr=document.getElementById("utr");

function showPopup(t,m){popupTitle.innerText=t;popupMsg.innerText=m;popupBg.style.display="flex"}
function closePopup(){popupBg.style.display="none"}
function copyUPI(){navigator.clipboard.writeText(UPI);showPopup("Copied","UPI ID copied")}
function pay(){
  const amt=Number(amount.value);
  if(amt<100){showPopup("Error","Minimum deposit â‚¹100");return;}
  location.href=`upi://pay?pa=${UPI}&pn=ColourCash&am=${amt}&cu=INR`;
}
</script>

<!-- FIREBASE SCRIPT -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app=initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db=getFirestore(app);

/* ðŸ”¥ MAIN FIX HERE */
window.submitDeposit = async function(){
  const amt=Number(amount.value);
  const utrVal=utr.value.trim();

  if(amt<100||utrVal.length<10){
    showPopup("Error","Enter valid amount & UTR");
    return;
  }

  const orderId="ORD"+Date.now();

  let deposits=JSON.parse(localStorage.getItem("deposits"))||[];
  deposits.push({
    orderId,
    amount:amt,
    utr:utrVal,
    status:"PENDING",
    time:new Date().toLocaleString()
  });
  localStorage.setItem("deposits",JSON.stringify(deposits));

  await addDoc(collection(db,"deposits"),{
    email:localStorage.getItem("userEmail"),
    amount:amt,
    utr:utrVal,
    status:"PENDING",
    time:new Date().toLocaleString()
  });

  showPopup("Success","Deposit submitted\nOrder ID: "+orderId);
  amount.value="";
  utr.value="";
};
</script>

</body>
</html>
