<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wheel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#244a86;
  color:#fff;
  text-align:center;
}

/* ===== WALLET ===== */
#walletBox{
  position:fixed;
  bottom:12px;right:12px;
  background:#000;
  padding:10px 18px;
  border-radius:22px;
  font-weight:bold;
  font-size:18px;
}

/* ===== TITLE ===== */
h1{margin:20px 0 10px;color:#ffd56a}

/* ===== POINTER ===== */
.pointer{
  width:0;height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-bottom:26px solid orange;
  margin:auto;
}

/* ===== WHEEL ===== */
.wheel-wrap{
  position:relative;
  width:320px;
  height:320px;
  margin:10px auto;
}
.wheel{
  width:100%;
  height:100%;
  border-radius:50%;
  border:10px solid #ffd56a;
  transition:transform 4s cubic-bezier(.17,.67,.2,1);
  background:conic-gradient(
    #ff4fa3 0deg 24deg,
    #2ec7ff 24deg 48deg,
    #ff4fa3 48deg 72deg,
    #2ec7ff 72deg 96deg,
    #ff4fa3 96deg 120deg,
    #2ec7ff 120deg 144deg,
    #ff4fa3 144deg 168deg,
    #2ec7ff 168deg 192deg,
    #ff4fa3 192deg 216deg,
    #2ec7ff 216deg 240deg,
    #ff4fa3 240deg 264deg,
    #2ec7ff 264deg 288deg,
    #ff4fa3 288deg 312deg,
    #2ec7ff 312deg 336deg,
    #ffd56a 336deg 360deg
  );
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
}
.center{
  position:absolute;
  font-size:26px;
}

/* ===== BET ===== */
.bet-row{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:14px 0;
}
.bet-btn{
  background:#ffd56a;
  color:#000;
  padding:10px 18px;
  border-radius:30px;
  font-weight:bold;
}

/* ===== MULTI ===== */
.multi-row{
  display:flex;
  justify-content:center;
  gap:10px;
}
.multi{
  padding:10px 18px;
  border-radius:18px;
  font-weight:bold;
}
.pink{background:#ff4fa3}
.blue{background:#2ec7ff}
.gold{background:#ffd56a;color:#000}

/* ===== SPIN ===== */
#spinBtn{
  margin:20px auto;
  width:220px;
  padding:14px;
  border-radius:40px;
  background:orange;
  color:#000;
  font-size:22px;
  font-weight:bold;
  cursor:pointer;
}
#spinBtn:disabled{opacity:.5}

#result{
  font-size:22px;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<h1>WHEEL</h1>

<div id="walletBox">ðŸ’° â‚¹<span id="walletAmt">0</span></div>

<div class="pointer"></div>

<div class="wheel-wrap">
  <div class="wheel" id="wheel">
    <div class="center">ðŸ’°</div>
  </div>
</div>

<div class="bet-row">
  <button class="bet-btn" onclick="betChange(-1)">âˆ’</button>
  <div class="bet-btn">Bet â‚¹<span id="betAmt">1</span></div>
  <button class="bet-btn" onclick="betChange(1)">+</button>
</div>

<div class="multi-row">
  <div class="multi pink">ðŸ’Ž 2x</div>
  <div class="multi gold">ðŸ’° 14x</div>
  <div class="multi blue">ðŸ’Ž 2x</div>
</div>

<button id="spinBtn" onclick="spin()">SPIN</button>

<div id="result"></div>

<!-- ===== FIREBASE + LOGIC ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

const email=localStorage.getItem("userEmail");
let uid="", wallet=0;

async function loadWallet(){
  const q=query(collection(db,"users"),where("email","==",email));
  const s=await getDocs(q);
  s.forEach(d=>{
    uid=d.id;
    wallet=Number(d.data().balance||0);
  });
  walletAmt.innerText=wallet;
}
function userRef(){return doc(db,"users",uid);}
loadWallet();

/* GAME */
let bet=1;
let spinning=false;
const wheel=document.getElementById("wheel");
const segments=15;
const degPer=360/segments;

function betChange(v){
  bet=Math.max(1,bet+v);
  betAmt.innerText=bet;
}

async function spin(){
  if(spinning) return;
  if(wallet<bet){alert("Low balance");return;}

  spinning=true;
  spinBtn.disabled=true;
  result.innerText="";

  wallet-=bet;
  walletAmt.innerText=wallet;
  await updateDoc(userRef(),{balance:wallet});

  const index=Math.floor(Math.random()*segments);
  const finalDeg=(360*5)+(360-(index*degPer)-(degPer/2));
  wheel.style.transform=`rotate(${finalDeg}deg)`;

  setTimeout(async ()=>{
    let multi=2;
    let text="ðŸ’Ž 2x";

    if(index===14){
      multi=14;
      text="ðŸ’° 14x";
    }

    const win=bet*multi;
    wallet+=win;
    walletAmt.innerText=wallet;
    await updateDoc(userRef(),{balance:wallet});

    result.innerText=`WIN ${text} â†’ â‚¹${win}`;
    spinning=false;
    spinBtn.disabled=false;
  },4200);
}
</script>

</body>
</html>
