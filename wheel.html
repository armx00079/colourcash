<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wheel Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#244a86;
  font-family:Arial;
  color:#fff;
  text-align:center;
}
h1{color:#ffd56a;margin:14px 0}

#wallet{
 position:fixed;
 right:12px;
 bottom:12px;
 background:#000;
 padding:10px 18px;
 border-radius:22px;
 font-weight:bold;
}

.pointer{
 width:0;height:0;
 border-left:14px solid transparent;
 border-right:14px solid transparent;
 border-bottom:26px solid orange;
 margin:auto;
}

.wheel-wrap{
 width:320px;
 height:320px;
 margin:10px auto 40px;
}
.wheel{
 width:100%;
 height:100%;
 border-radius:50%;
 border:10px solid #ffd56a;
 transition:transform 4s cubic-bezier(.17,.67,.2,1);
 background:conic-gradient(
  #ff4fa3 0deg 24deg,
  #2ec7ff 24deg 48deg,
  #ff4fa3 48deg 72deg,
  #2ec7ff 72deg 96deg,
  #ff4fa3 96deg 120deg,
  #2ec7ff 120deg 144deg,
  #ff4fa3 144deg 168deg,
  #2ec7ff 168deg 192deg,
  #ff4fa3 192deg 216deg,
  #2ec7ff 216deg 240deg,
  #ff4fa3 240deg 264deg,
  #2ec7ff 264deg 288deg,
  #ff4fa3 288deg 312deg,
  #2ec7ff 312deg 336deg,
  #ffd56a 336deg 360deg
 );
}

.bet-row{display:flex;justify-content:center;gap:10px;margin-bottom:10px}
.btn{
 background:#ffd56a;
 color:#000;
 padding:12px 18px;
 border-radius:20px;
 font-weight:bold;
 cursor:pointer;
}
.mult{
 padding:10px 16px;
 border-radius:16px;
 font-weight:bold;
 cursor:pointer;
 opacity:.5;
}
.mult.active{opacity:1;outline:3px solid #fff}
.pink{background:#ff4fa3}
.blue{background:#2ec7ff}
.gold{background:#ffd56a;color:#000}

.spin{
 background:#ffb000;
 color:#000;
 padding:14px 60px;
 border-radius:28px;
 font-size:20px;
 font-weight:bold;
 cursor:pointer;
}

.popup{
 position:fixed;inset:0;
 background:rgba(0,0,0,.6);
 display:none;
 align-items:center;justify-content:center;
}
.popup .box{
 padding:30px 50px;
 border-radius:20px;
 font-size:26px;
 font-weight:bold;
}
.win{background:#ffd56a;color:#000}
.loss{background:#b00020}
</style>
</head>

<body>

<h1>WHEEL</h1>
<div class="pointer"></div>

<div class="wheel-wrap">
 <div class="wheel" id="wheel"></div>
</div>

<div class="bet-row">
 <div class="btn" id="minus">-</div>
 <div class="btn" id="bet">Bet â‚¹1</div>
 <div class="btn" id="plus">+</div>
</div>

<div class="bet-row">
 <div class="mult pink" data-type="pink">ðŸ’Ž 2x</div>
 <div class="mult gold" data-type="gold">ðŸ’° 14x</div>
 <div class="mult blue" data-type="blue">ðŸ’Ž 2x</div>
</div>

<div class="spin" id="spin">SPIN</div>

<div id="wallet">ðŸ’° â‚¹<span id="bal">0</span></div>

<div class="popup" id="popup">
 <div class="box" id="popupBox"></div>
</div>

<!-- ðŸ”¥ FIREBASE (KENO STYLE WALLET) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, collection, query, where, getDocs, doc, updateDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e",
  storageBucket: "colourcash-ea60e.firebasestorage.app",
  messagingSenderId: "403688058646",
  appId: "1:403688058646:web:f1753360471528f275ea37"
});
const db = getFirestore(app);

const email = localStorage.getItem("userEmail");
let uid="", balance=0;

const bal=document.getElementById("bal");
const wheel=document.getElementById("wheel");

async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
   uid=d.id;
   balance=Number(d.data().balance||0);
 });
 bal.innerText=balance;
}
function userRef(){ return doc(db,"users",uid); }
await loadWallet();

/* ===== GAME LOGIC (UNCHANGED) ===== */
let bet=1, selected=null, rotation=0;
let games=Number(localStorage.getItem("W_GAMES")||0);
let wins =Number(localStorage.getItem("W_WINS")||0);

document.querySelectorAll(".mult").forEach(b=>{
 b.onclick=()=>{
  document.querySelectorAll(".mult").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  selected=b.dataset.type;
 };
});

minus.onclick=()=>{ if(bet>1){bet--;betBtn()} }
plus.onclick=()=>{ bet++;betBtn() }
function betBtn(){ document.getElementById("bet").innerText="Bet â‚¹"+bet }

spin.onclick=async ()=>{
 if(!selected || balance<bet) return;

 balance-=bet;
 bal.innerText=balance;
 await updateDoc(userRef(),{balance});

 games++; localStorage.setItem("W_GAMES",games);

 let guaranteed=(games===1||games===3);
 let winChance=bet<=50?0.45:bet<=200?0.35:0.25;
 let win=guaranteed||(Math.random()<winChance&&wins<6);

 let payout=0, angle=0;

 if(win){
  wins++; localStorage.setItem("W_WINS",wins);
  if(selected==="gold"){payout=Math.min(bet*14,200);angle=350;}
  else{payout=Math.min(bet*2,200);angle=selected==="pink"?60:120;}
 }else angle=200;

 rotation+=360*6+angle;
 wheel.style.transform="rotate("+rotation+"deg)";

 setTimeout(async ()=>{
  if(win){
    balance+=payout;
    bal.innerText=balance;
    await updateDoc(userRef(),{balance});
    showPopup("YOU WIN â‚¹"+payout,true);
  }else showPopup("YOU LOSE",false);
 },4200);
};

function showPopup(t,w){
 const p=document.getElementById("popup");
 const b=document.getElementById("popupBox");
 b.className="box "+(w?"win":"loss");
 b.innerText=t;
 p.style.display="flex";
 setTimeout(()=>p.style.display="none",2000);
}
</script>

</body>
</html>
