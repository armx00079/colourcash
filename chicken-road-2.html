<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chicken Road 2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#1a1a1a,#000);
  color:#fff;
  text-align:center;
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  font-weight:bold;
}
.wallet{
  background:rgba(0,0,0,.6);
  padding:6px 14px;
  border-radius:20px;
}

/* MODE SELECT */
.modes{
  display:flex;
  gap:10px;
  justify-content:center;
  margin:10px;
}
.mode{
  padding:8px 14px;
  border-radius:16px;
  background:#222;
  cursor:pointer;
  font-size:13px;
}
.mode.active{
  background:#ff4081;
  color:#000;
  font-weight:bold;
}

/* ROAD */
.road{
  perspective:900px;
  margin:20px auto;
  width:90%;
  max-width:360px;
}
.track{
  transform:rotateX(20deg);
}
.tile{
  height:46px;
  margin:8px 0;
  border-radius:12px;
  background:linear-gradient(135deg,#2ecc71,#1e8449);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 14px;
  font-size:14px;
  opacity:.4;
}
.tile.active{
  opacity:1;
  box-shadow:0 0 14px #2ecc71;
}
.tile.bomb{
  background:linear-gradient(135deg,#ff5252,#b71c1c);
}

/* CHICKEN */
.chicken{
  font-size:26px;
}

/* CONTROLS */
.controls{
  margin:14px;
}
input{
  width:70%;
  padding:12px;
  border-radius:30px;
  border:none;
  margin-bottom:10px;
}
button{
  width:70%;
  padding:14px;
  border-radius:30px;
  border:none;
  background:#ffb300;
  font-size:16px;
  font-weight:bold;
  margin-top:6px;
}

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#ffb300;
  color:#000;
  padding:24px 40px;
  border-radius:20px;
  font-size:22px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <div>üêî CHICKEN ROAD</div>
  <div class="wallet">‚Çπ <span id="wallet">0</span></div>
</div>

<!-- MODES -->
<div class="modes">
  <div class="mode active" data-mode="easy">EASY</div>
  <div class="mode" data-mode="medium">MEDIUM</div>
  <div class="mode" data-mode="hard">HARD</div>
  <div class="mode" data-mode="hardcore">HARDCORE</div>
</div>

<!-- ROAD -->
<div class="road">
  <div class="track" id="track"></div>
</div>

<div class="controls">
  <input type="number" id="bet" value="100">
  <br>
  <button id="start">START</button>
  <button id="cashout">CASHOUT</button>
</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script type="module">
/* üî• FIREBASE WALLET (SAME SYSTEM AS PLINKO/DICE) */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);
const userEmail = localStorage.getItem("userEmail");

let wallet=0, uid="";

/* LOAD WALLET */
async function loadWallet(){
  const q=query(collection(db,"users"),where("email","==",userEmail));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    uid=d.id;
    wallet=Number(d.data().balance||0);
  });
  renderWallet();
}
async function saveWallet(){
  if(uid) await updateDoc(doc(db,"users",uid),{balance:wallet});
}
function renderWallet(){
  document.getElementById("wallet").innerText=wallet;
}

/* MULTIPLIERS (EXACT AS YOU GAVE) */
const MULTI={
 easy:[1.02,1.08,1.14,1.21,1.29,1.37,1.46,1.56,1.67,1.8,1.94,2.09,2.27,2.47,2.69,2.95,3.24,3.58,3.98,4.45,5.01,5.68,6.49,7.49,8.74,10.33,12.39,15.15,18.94,24.35],
 medium:[1.08,1.22,1.38,1.57,1.79,2.06,2.38,2.78,3.27,3.89,4.67,5.67,6.98,8.73,11.11,14.44,19.25,26.48,37.83,56.74,90.79,158.88,317.77,794.43,3177.72],
 hard:[1.19,1.47,1.84,2.32,2.97,3.84,5.05,6.73,9.13,12.65,17.92,26.07,39.11,60.84,98.87,169.49,310.74,621.49,1398.35,3728.95,13051.35,78308.1],
 hardcore:[1.45,2.22,3.47,5.56,9.13,15.46,27.06,49.21,93.5,187.01,397.39,908.33,2270.83,6358.35,20664.63,82658.55,456622.02,4546220.25]
};

let mode="easy", step=0, bet=0, alive=false;

/* MODE SELECT */
document.querySelectorAll(".mode").forEach(m=>{
  m.onclick=()=>{
    document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
    m.classList.add("active");
    mode=m.dataset.mode;
  };
});

/* BUILD ROAD */
const track=document.getElementById("track");
function buildRoad(){
  track.innerHTML="";
  MULTI[mode].forEach((m,i)=>{
    const t=document.createElement("div");
    t.className="tile";
    t.innerHTML=`<span>${m}x</span><span class="chicken">üêî</span>`;
    track.appendChild(t);
  });
}
buildRoad();

/* START */
start.onclick=async()=>{
  bet=Number(betInp.value||0);
  if(bet<=0||bet>wallet) return alert("Low balance");
  wallet-=bet; await saveWallet(); renderWallet();
  step=0; alive=true;
  nextStep();
};

/* NEXT STEP */
function nextStep(){
  if(!alive) return;
  const tiles=document.querySelectorAll(".tile");
  tiles.forEach(t=>t.classList.remove("active","bomb"));
  tiles[step].classList.add("active");

  // bomb chance increases with bet size
  const risk=Math.min(0.65,0.25 + bet/(wallet+bet));
  if(Math.random()<risk){
    tiles[step].classList.add("bomb");
    lose();
    return;
  }
}

/* CASHOUT */
cashout.onclick=async()=>{
  if(!alive) return;
  const win=Math.round(bet*MULTI[mode][step]);
  wallet+=win; await saveWallet(); renderWallet();
  popupText.innerText=`üí∞ CASHOUT ‚Çπ${win}`;
  popup.style.display="flex";
  alive=false;
  setTimeout(()=>popup.style.display="none",1500);
};

/* LOSE */
function lose(){
  alive=false;
  popupText.innerText="üí• BOOM! YOU LOST";
  popup.style.display="flex";
  setTimeout(()=>popup.style.display="none",1500);
}

/* STEP CLICK */
track.onclick=()=>{
  if(!alive) return;
  step++;
  if(step>=MULTI[mode].length) return cashout.onclick();
  nextStep();
};

loadWallet();
</script>

</body>
</html>
