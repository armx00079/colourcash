<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dragon Tiger</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle at top,#0b1c2d,#030b14);
  color:#fff;
}

/* ===== HEADER ===== */
.game-header{
background:linear-gradient(180deg,#2b1c3a,#1a1025);
padding:14px 10px 10px;
}
.header-arena{
display:flex;
align-items:center;
justify-content:space-between;
}
.header-arena img{height:80px}
.center-cards{display:flex;align-items:center;gap:10px}

/* ===== TOP CARDS ===== */
.play-card{width:46px;height:62px;perspective:800px}
.play-card .inner{
width:100%;height:100%;
transform-style:preserve-3d;
transition:.6s;
}
.play-card.flip .inner{transform:rotateY(180deg)}
.play-card .front,
.play-card .back{
position:absolute;inset:0;
backface-visibility:hidden;
border-radius:8px;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
}
.play-card .front{background:linear-gradient(135deg,#ffb85c,#ff8c1a)}
.play-card .back{background:#fff;color:#000;transform:rotateY(180deg)}

.bet-btn{
margin:10px auto 6px;
width:220px;
padding:12px 0;
text-align:center;
border-radius:30px;
background:linear-gradient(135deg,#ffcf6a,#ff9f1a);
color:#000;
font-weight:bold;
font-size:18px;
}

/* ===== TABLE ===== */
.table-wrap{display:flex;justify-content:center;margin-top:20px}
.table{
width:360px;
background:linear-gradient(#1a2f4a,#0b1c2d);
border-radius:18px;
padding:18px;
}
.cards{display:flex;justify-content:space-between;align-items:center}

.card,.tie{
position:relative;
font-weight:bold;
cursor:pointer;
}
.card{
width:135px;height:95px;
border-radius:16px;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:4px;
}
.dragon{background:#4a5fe0}
.tiger{background:#ff8c1a}
.tie{
margin:14px auto 0;
width:200px;height:70px;
border-radius:16px;
background:#2ecc71;
display:flex;align-items:center;justify-content:center;
}

.bet-amt{
position:absolute;
top:6px;right:8px;
background:rgba(0,0,0,.6);
padding:3px 8px;
border-radius:12px;
font-size:13px;
display:none;
}

.card.active,.tie.active{
box-shadow:0 0 18px gold;
transform:scale(1.03);
}

/* ===== DRAGON TIGER CARD IMAGE (ADDED) ===== */
.card img{
width:38px;
height:38px;
object-fit:contain;
}

/* ===== CHIPS ===== */
.chips{display:flex;justify-content:center;gap:10px;margin:18px auto}
.chip{
width:46px;height:46px;
border-radius:50%;
background:#ffd56a;
display:flex;align-items:center;justify-content:center;
color:#000;font-weight:bold;
cursor:pointer;
}
.chip.active{outline:3px solid #fff}
.locked{pointer-events:none;opacity:.4}

/* ===== POPUP ===== */
.popup{
position:fixed;inset:0;
background:rgba(0,0,0,.6);
display:none;
align-items:center;justify-content:center;
}
.popup-box{
background:linear-gradient(135deg,#ffd56a,#ff9f1a);
color:#000;
padding:30px 50px;
border-radius:20px;
font-size:26px;
font-weight:bold;
}

/* ===== WALLET ===== */
#walletBox{
position:fixed;
bottom:12px;right:12px;
background:#000;
padding:10px 18px;
border-radius:22px;
font-weight:bold;
font-size:18px;
}

/* ===== RESULT HISTORY ===== */
.history-wrap{
width:360px;
margin:12px auto;
background:#071421;
padding:12px;
border-radius:14px;
}
.history-title{
text-align:center;
margin-bottom:8px;
font-weight:bold;
color:#ffd56a;
}
.history{
display:flex;
gap:6px;
justify-content:center;
flex-wrap:wrap;
}
.h-item{
width:34px;
height:34px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:12px;
font-weight:bold;
}
.h-dragon{background:#4a5fe0}
.h-tiger{background:#ff8c1a}
.h-tie{background:#2ecc71}
</style>
</head>

<body>

<div id="walletBox">ðŸ’° â‚¹<span id="walletAmt">0</span></div>

<div class="game-header">
  <div class="header-arena">
    <img src="images/dragon.png">
    <div class="center-cards">
      <div class="play-card" id="topDragon">
        <div class="inner">
          <div class="front"></div>
          <div class="back" id="dVal"></div>
        </div>
      </div>
      <div>VS</div>
      <div class="play-card" id="topTiger">
        <div class="inner">
          <div class="front"></div>
          <div class="back" id="tVal"></div>
        </div>
      </div>
    </div>
    <img src="images/tiger.png">
  </div>
  <div class="bet-btn" id="betStatus">START BETTING</div>
</div>

<div class="table-wrap">
  <div class="table">
    <div class="cards">
      <div class="card dragon" id="dragon">
        <img src="images/dragon.png">
        DRAGON
        <span class="bet-amt" id="bet-dragon"></span>
      </div>
      <div>VS</div>
      <div class="card tiger" id="tiger">
        <img src="images/tiger.png">
        TIGER
        <span class="bet-amt" id="bet-tiger"></span>
      </div>
    </div>
    <div class="tie" id="tie">TIE <span class="bet-amt" id="bet-tie"></span></div>
  </div>
</div>

<div class="history-wrap">
  <div class="history-title">LAST RESULTS</div>
  <div class="history" id="history"></div>
</div>

<div class="chips">
  <div class="chip">10</div>
  <div class="chip">50</div>
  <div class="chip">100</div>
  <div class="chip">500</div>
  <div class="chip">1000</div>
</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

const email = localStorage.getItem("userEmail");
let uid="", wallet=0;

async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const s=await getDocs(q);
 s.forEach(d=>{uid=d.id;wallet=Number(d.data().balance||0);});
 walletAmt.innerText=wallet;
}
function userRef(){return doc(db,"users",uid);}
loadWallet();

/* ===== GAME LOGIC ===== */
let selectedChip=0;
let phase="bet";
let timer=15;
let bets={DRAGON:0,TIGER:0,TIE:0};

const CARDS=[
{n:"A",v:14},{n:"K",v:13},{n:"Q",v:12},{n:"J",v:11},
{n:"10",v:10},{n:"9",v:9},{n:"8",v:8},{n:"7",v:7},
{n:"6",v:6},{n:"5",v:5},{n:"4",v:4},{n:"3",v:3},{n:"2",v:2}
];
const MULTI={DRAGON:2,TIGER:2,TIE:13};

document.querySelectorAll(".chip").forEach(c=>{
 c.onclick=()=>{
  if(phase!=="bet")return;
  document.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
  c.classList.add("active");
  selectedChip=parseInt(c.innerText);
 };
});

["dragon","tiger","tie"].forEach(id=>{
 const el=document.getElementById(id);
 el.onclick=async ()=>{
  if(phase!=="bet"||!selectedChip||wallet<selectedChip)return;

  wallet-=selectedChip;
  walletAmt.innerText=wallet;
  await updateDoc(userRef(),{balance:wallet});

  bets[id.toUpperCase()]+=selectedChip;
  const b=document.getElementById("bet-"+id);
  b.innerText="â‚¹"+bets[id.toUpperCase()];
  b.style.display="block";

  document.querySelectorAll(".card,.tie").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
 };
});

function startTimer(){
 betStatus.innerText="START BETTING (10)";
 timer=15;
 phase="bet";

 const t=setInterval(()=>{
  timer--;

  if(timer>5){
    phase="bet";
    betStatus.innerText="START BETTING ("+(timer-5)+")";
  }else if(timer>0){
    phase="lock";
    betStatus.innerText="BET LOCK ("+timer+")";
    document.querySelectorAll(".chip").forEach(c=>c.classList.add("locked"));
  }else{
    clearInterval(t);
    showResult();
  }
 },1000);
}

async function showResult(){
 phase="result";

 const d=CARDS[Math.floor(Math.random()*CARDS.length)];
 const t=CARDS[Math.floor(Math.random()*CARDS.length)];
 dVal.innerText=d.n; tVal.innerText=t.n;
 topDragon.classList.add("flip");
 topTiger.classList.add("flip");

 let win="TIE";
 if(d.v>t.v) win="DRAGON";
 else if(t.v>d.v) win="TIGER";

 if(bets[win]>0){
  wallet+=bets[win]*MULTI[win];
  walletAmt.innerText=wallet;
  await updateDoc(userRef(),{balance:wallet});
 }

 popupText.innerText=win+" WINS";
 popup.style.display="flex";

 saveHistory(win);

 setTimeout(()=>location.reload(),2500);
}

/* ===== RESULT HISTORY JS ===== */
function saveHistory(result){
 let h=JSON.parse(localStorage.getItem("dt_history")||"[]");
 h.unshift(result);
 if(h.length>10)h.pop();
 localStorage.setItem("dt_history",JSON.stringify(h));
}
function loadHistory(){
 const box=document.getElementById("history");
 if(!box)return;
 box.innerHTML="";
 let h=JSON.parse(localStorage.getItem("dt_history")||"[]");
 h.forEach(r=>{
  const d=document.createElement("div");
  d.className="h-item h-"+r.toLowerCase();
  d.innerText=r[0];
  box.appendChild(d);
 });
}
loadHistory();

startTimer();
</script>

</body>
</html>
