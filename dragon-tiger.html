<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dragon Tiger</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle at top,#0b1c2d,#030b14);
  color:#fff;
}

/* ===== HEADER ===== */
.game-header{
background:linear-gradient(180deg,#2b1c3a,#1a1025);
padding:14px 10px 10px;
}
.header-arena{
display:flex;
align-items:center;
justify-content:space-between;
}
.header-arena img{height:80px}
.center-cards{display:flex;align-items:center;gap:10px}

/* ===== TOP CARDS ===== */
.play-card{width:46px;height:62px;perspective:800px}
.play-card .inner{
width:100%;height:100%;
transform-style:preserve-3d;
transition:.6s;
}
.play-card.flip .inner{transform:rotateY(180deg)}
.play-card .front,
.play-card .back{
position:absolute;inset:0;
backface-visibility:hidden;
border-radius:8px;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
}
.play-card .front{background:linear-gradient(135deg,#ffb85c,#ff8c1a)}
.play-card .back{background:#fff;color:#000;transform:rotateY(180deg)}

.bet-btn{
margin:10px auto 6px;
width:200px;
padding:10px 0;
text-align:center;
border-radius:20px;
background:linear-gradient(135deg,#ffcf6a,#ff9f1a);
color:#000;
font-weight:bold;
}

.last-history{
display:flex;
justify-content:center;
gap:6px;
margin-bottom:6px;
}

/* ===== TABLE ===== */
.table-wrap{display:flex;justify-content:center;margin-top:20px}
.table{
width:360px;
background:linear-gradient(#1a2f4a,#0b1c2d);
border-radius:18px;
padding:18px;
}
.cards{display:flex;justify-content:space-between;align-items:center}

.card,.tie{position:relative;font-weight:bold}
.card{
width:135px;height:95px;
border-radius:16px;
display:flex;align-items:center;justify-content:center;
}
.dragon{background:#4a5fe0}
.tiger{background:#ff8c1a}
.tie{
margin:14px auto 0;
width:200px;height:70px;
border-radius:16px;
background:#2ecc71;
display:flex;align-items:center;justify-content:center;
}

/* ===== BET AMOUNT ===== */
.bet-amt{
position:absolute;
top:6px;right:8px;
background:rgba(0,0,0,.6);
padding:3px 8px;
border-radius:12px;
font-size:13px;
display:none;
}

.card.active,.tie.active{
box-shadow:0 0 18px gold;
transform:scale(1.03);
}

/* ===== CHIPS ===== */
.chips{display:flex;justify-content:center;gap:10px;margin:18px auto}
.chip{
width:46px;height:46px;
border-radius:50%;
background:#ffd56a;
display:flex;align-items:center;justify-content:center;
color:#000;font-weight:bold;
cursor:pointer;
}
.chip.active{outline:3px solid #fff}
.locked{pointer-events:none;opacity:.4}

/* ===== POPUP ===== */
.popup{
position:fixed;inset:0;
background:rgba(0,0,0,.6);
display:none;
align-items:center;justify-content:center;
}
.popup-box{
background:linear-gradient(135deg,#ffd56a,#ff9f1a);
color:#000;
padding:30px 50px;
border-radius:20px;
font-size:26px;
font-weight:bold;
}

/* ===== WALLET ===== */
#walletBox{
position:fixed;
bottom:12px;right:12px;
background:#000;
padding:8px 14px;
border-radius:20px;
font-weight:bold;
}

/* ===== LIVE FEED ===== */
.live-feed{
margin:15px auto;
width:90%;
max-width:360px;
height:120px;
overflow:hidden;
background:linear-gradient(#0e2238,#081423);
border-radius:16px;
padding:10px;
}
.live-item{
font-size:14px;
padding:6px 0;
opacity:.9;
}
</style>
</head>

<body>

<div id="walletBox">ðŸ’° â‚¹<span id="walletAmt">0</span></div>

<!-- ================= GAME UI ================= -->
<div class="game-header">
  <div class="header-arena">
    <img src="images/dragon.png">
    <div class="center-cards">
      <div class="play-card" id="topDragon">
        <div class="inner">
          <div class="front"></div>
          <div class="back" id="dVal"></div>
        </div>
      </div>
      <div>VS</div>
      <div class="play-card" id="topTiger">
        <div class="inner">
          <div class="front"></div>
          <div class="back" id="tVal"></div>
        </div>
      </div>
    </div>
    <img src="images/tiger.png">
  </div>
  <div class="bet-btn" id="betStatus">START BETTING</div>
</div>

<div class="table-wrap">
  <div class="table">
    <div class="cards">
      <div class="card dragon" id="dragon">DRAGON <span class="bet-amt" id="bet-dragon"></span></div>
      <div>VS</div>
      <div class="card tiger" id="tiger">TIGER <span class="bet-amt" id="bet-tiger"></span></div>
    </div>
    <div class="tie" id="tie">TIE <span class="bet-amt" id="bet-tie"></span></div>
  </div>
</div>

<div class="chips">
  <div class="chip">10</div>
  <div class="chip">50</div>
  <div class="chip">100</div>
  <div class="chip">500</div>
  <div class="chip">1000</div>
</div>

<div class="live-feed" id="liveFeed"></div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script>
let wallet = 0;
let selectedChip = 0;
let phase = "bet";
let timer = 15;
let bets = {DRAGON:0,TIGER:0,TIE:0};

const MULTI={DRAGON:2,TIGER:2,TIE:13};

const CARDS=[
{n:"A",v:14},{n:"K",v:13},{n:"Q",v:12},{n:"J",v:11},
{n:"10",v:10},{n:"9",v:9},{n:"8",v:8},{n:"7",v:7},
{n:"6",v:6},{n:"5",v:5},{n:"4",v:4},{n:"3",v:3},{n:"2",v:2}
];

const walletAmt=document.getElementById("walletAmt");

/* CHIP SELECT */
document.querySelectorAll(".chip").forEach(c=>{
c.onclick=()=>{
if(phase!=="bet")return;
document.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
c.classList.add("active");
selectedChip=parseInt(c.innerText);
};
});

/* BET */
["dragon","tiger","tie"].forEach(id=>{
document.getElementById(id).onclick=()=>{
if(phase!=="bet"||!selectedChip||wallet<selectedChip)return;

wallet -= selectedChip;
walletAmt.innerText = wallet;
updateMainWallet();   // ðŸ”¥ FIREBASE UPDATE

bets[id.toUpperCase()] += selectedChip;

const b=document.getElementById("bet-"+id);
b.innerText="â‚¹"+bets[id.toUpperCase()];
b.style.display="block";
};
});

/* TIMER */
function startTimer(){
const t=setInterval(()=>{
timer--;
betStatus.innerText=timer>0?timer:"RESULT";
if(timer<=0){clearInterval(t); showResult();}
},1000);
}

/* RESULT */
function showResult(){
const d=CARDS[Math.floor(Math.random()*CARDS.length)];
const t=CARDS[Math.floor(Math.random()*CARDS.length)];
dVal.innerText=d.n; tVal.innerText=t.n;
topDragon.classList.add("flip"); topTiger.classList.add("flip");

let win="TIE";
if(d.v>t.v) win="DRAGON";
else if(t.v>d.v) win="TIGER";

if(bets[win]>0){
wallet += bets[win]*MULTI[win];
walletAmt.innerText = wallet;
updateMainWallet();   // ðŸ”¥ FIREBASE UPDATE
}

popupText.innerText=win+" WINS";
popup.style.display="flex";

setTimeout(()=>{popup.style.display="none"; resetRound();},2500);
}

function resetRound(){
bets={DRAGON:0,TIGER:0,TIE:0};
timer=15;
document.querySelectorAll(".bet-amt").forEach(b=>b.style.display="none");
topDragon.classList.remove("flip"); topTiger.classList.remove("flip");
dVal.innerText=""; tVal.innerText="";
startTimer();
}

/* GAME START */
loadMainWallet();   // ðŸ”¥ FIREBASE WALLET LOAD
startTimer();
</script>

<!-- ================= FIREBASE INIT ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e"
});

const db = getFirestore(app);
const userEmail = localStorage.getItem("userEmail");
let userDocId = "";

async function loadMainWallet(){
  const snap = await getDocs(
    query(collection(db,"users"), where("email","==",userEmail))
  );
  snap.forEach(d=>{
    userDocId = d.id;
    wallet = d.data().balance || 0;
    walletAmt.innerText = wallet;
  });
}

async function updateMainWallet(){
  if(!userDocId) return;
  await updateDoc(doc(db,"users",userDocId),{ balance: wallet });
}

window.loadMainWallet = loadMainWallet;
window.updateMainWallet = updateMainWallet;
</script>

</body>
</html>
