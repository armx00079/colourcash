<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŽ¡ Roulette</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0e3b2f;color:#fff}
.header{text-align:center;padding:14px;font-size:22px;font-weight:bold}
.card{background:#0f5132;margin:10px;padding:12px;border-radius:14px}
.center{text-align:center}
.timer{font-size:22px;color:#ffd54f}
.lock{color:#ffcc00;margin-top:6px}

/* ===== WHEEL ===== */
.wheel-wrap{display:flex;justify-content:center;margin:20px 0}
.wheel{
  width:300px;height:300px;border-radius:50%;
  border:14px solid #111;
  background:repeating-conic-gradient(#c62828 0deg 10deg,#111 10deg 20deg);
  box-shadow:inset 0 0 25px rgba(0,0,0,.9);
  transition:transform 4.5s cubic-bezier(.22,.61,.36,1);
  position:relative;
}
.wheel span{
  position:absolute;
  top:50%;left:50%;
  transform-origin:0 0;
  font-size:13px;
  font-weight:bold;
  pointer-events:none;
}

/* ===== GRID ===== */
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
.num{padding:12px 0;border-radius:8px;font-weight:bold;text-align:center;cursor:pointer}
.red{background:#c62828}
.black{background:#111}
.green{background:#2e7d32}
.num.active{outline:3px solid #00e5ff}

/* ===== CONTROLS ===== */
.controls{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
.ctrl{background:#333;padding:12px;border-radius:10px;text-align:center;font-weight:bold;cursor:pointer}
.ctrl.active{outline:3px solid #00e5ff;background:#555}

input{width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px}
button{width:100%;padding:14px;margin-top:10px;border:none;border-radius:12px;background:#2196f3;color:#fff;font-size:16px;font-weight:bold}
button:disabled{opacity:.5}

.history{font-size:14px;line-height:1.6;margin-top:6px}

/* POPUP */
.popup{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
.popup div{background:#1b1b1b;padding:22px;border-radius:14px;font-size:18px}
.win{color:#4caf50}
.lose{color:#ff5252}
.warn{color:#ff5252}

.blur{filter:blur(3px)}
</style>
</head>

<body>

<div class="header">ðŸŽ¡ ROULETTE</div>

<div class="card center">
  <div id="wallet">Wallet: â‚¹0</div>
  <div class="timer" id="timer">25s</div>
  <div id="lockText"></div>
</div>

<div class="wheel-wrap">
  <div id="wheel" class="wheel"></div>
</div>

<div class="card" id="game">
  <div class="grid" id="numbers"></div>

  <div class="controls">
    <div class="ctrl" onclick="selectGroup('RED',this)">RED</div>
    <div class="ctrl" onclick="selectGroup('BLACK',this)">BLACK</div>
    <div class="ctrl" onclick="selectGroup('EVEN',this)">EVEN</div>
    <div class="ctrl" onclick="selectGroup('ODD',this)">ODD</div>
    <div class="ctrl" onclick="selectGroup('LOW',this)">1â€“18</div>
    <div class="ctrl" onclick="selectGroup('HIGH',this)">19â€“36</div>
  </div>

  <input id="amount" type="number" placeholder="Min â‚¹1">
  <button onclick="placeBet()">PLACE BET</button>
</div>

<div class="card">
  <b>Last Results</b>
  <div class="history" id="last"></div>
</div>

<div class="card">
  <b>My Bets</b>
  <div class="history" id="bets"></div>
</div>

<div class="popup" id="popup"><div id="popupText"></div></div>

<!-- ðŸ”¥ FIREBASE WALLET ONLY -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e"
});
const db = getFirestore(app);

let uid = "";
const email = localStorage.getItem("userEmail");

async function loadWallet(){
  if(!email) return;
  const q = query(collection(db,"users"), where("email","==",email));
  const s = await getDocs(q);
  s.forEach(d=>{
    uid = d.id;
    state.wallet = d.data().balance || 0;
  });
  render();
}

async function syncWallet(){
  if(!uid) return;
  await updateDoc(doc(db,"users",uid),{ balance: state.wallet });
}
</script>

<script>
/* ===== ORIGINAL GAME CODE (UNCHANGED) ===== */
let state=JSON.parse(localStorage.getItem("roulette_state"))||{
  wallet:0,phase:"BET",time:25,selected:null,bets:[],last:[]
};
const save=()=>localStorage.setItem("roulette_state",JSON.stringify(state));

const red=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
const black=[2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35];

const wheel=document.getElementById("wheel");

/* BUILD WHEEL */
for(let i=0;i<37;i++){
  let s=document.createElement("span");
  let ang=(360/37)*i;
  s.style.transform=`rotate(${ang}deg) translate(135px) rotate(-${ang}deg)`;
  s.innerText=i;
  s.style.color=i===0?"#00e676":red.includes(i)?"#ff5252":"#fff";
  wheel.appendChild(s);
}

/* GRID */
const grid=document.getElementById("numbers");
for(let i=0;i<=36;i++){
  let d=document.createElement("div");
  d.className="num "+(i===0?"green":red.includes(i)?"red":"black");
  d.innerText=i;
  d.onclick=()=>selectNumber(i,d);
  grid.appendChild(d);
}

function clearSel(){
  document.querySelectorAll(".num").forEach(x=>x.classList.remove("active"));
  document.querySelectorAll(".ctrl").forEach(x=>x.classList.remove("active"));
}

function selectNumber(n,el){
  if(state.phase!=="BET")return;
  clearSel();el.classList.add("active");
  state.selected={type:"NUMBER",value:n};
}
function selectGroup(g,el){
  if(state.phase!=="BET")return;
  clearSel();el.classList.add("active");
  state.selected={type:g};
}

function popupMsg(msg,cls){
  popupText.className=cls||"";
  popupText.innerText=msg;
  popup.style.display="flex";
  setTimeout(()=>popup.style.display="none",1800);
}

function placeBet(){
  let amt=+amount.value;
  if(amt>state.wallet){ popupMsg("INSUFFICIENT BALANCE","warn"); return; }
  if(!state.selected||amt<1)return;

  state.wallet-=amt;
  syncWallet();
  state.bets.unshift({type:state.selected.type,value:state.selected.value,amt,res:"PENDING"});
  popupMsg("BET PLACED");
  save();render();
}

/* SPIN */
function spin(){
  let result=Math.floor(Math.random()*37);
  let angle=(360/37)*result;

  wheel.style.transition="none";
  wheel.style.transform="rotate(0deg)";
  void wheel.offsetWidth;

  wheel.style.transition="transform 4.5s cubic-bezier(.22,.61,.36,1)";
  wheel.style.transform=`rotate(${360*6+angle}deg)`;

  setTimeout(()=>{
    state.last.unshift(result);
    state.last=state.last.slice(0,10);

    state.bets.forEach(b=>{
      if(b.res!=="PENDING")return;
      let win=false;
      if(b.type==="NUMBER"&&b.value===result) win=true;
      if(b.type==="RED"&&red.includes(result)) win=true;
      if(b.type==="BLACK"&&black.includes(result)) win=true;
      if(b.type==="EVEN"&&result!==0&&result%2===0) win=true;
      if(b.type==="ODD"&&result%2===1) win=true;
      if(b.type==="LOW"&&result>=1&&result<=18) win=true;
      if(b.type==="HIGH"&&result>=19) win=true;

      if(win){
        let w=b.amt*2;
        state.wallet+=w;
        syncWallet();
        b.res="WIN â‚¹"+w;
        popupMsg(`ðŸŽ‰ ${result} â†’ WIN â‚¹${w}`,"win");
      }else{
        b.res="LOSS";
        popupMsg(`âŒ ${result} â†’ LOSS`,"lose");
      }
    });
    save();render();
  },4600);
}

/* LOOP */
setInterval(()=>{
  state.time--;
  if(state.phase==="BET"&&state.time===5){
    state.phase="LOCK";
    lockText.innerText="ðŸ”’ BET LOCKED";
    game.classList.add("blur");
  }
  if(state.phase==="LOCK"&&state.time===0){
    spin();
    state.phase="RESULT";
    state.time=5;
  }
  if(state.phase==="RESULT"&&state.time===0){
    state.phase="BET";
    state.time=25;
    state.selected=null;
    clearSel();
    lockText.innerText="";
    game.classList.remove("blur");
  }
  save();render();
},1000);

function render(){
  wallet.innerText=`Wallet: â‚¹${state.wallet}`;
  timer.innerText=state.time+"s";
  last.innerHTML=state.last.join(", ");
  bets.innerHTML=state.bets.map(b=>`${b.type} â‚¹${b.amt} â†’ ${b.res}`).join("<br>");
}

loadWallet();
render();
</script>

</body>
</html>
