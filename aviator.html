<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.header{text-align:center;padding:12px;font-size:22px;font-weight:bold}
.top{display:flex;justify-content:space-between;padding:10px 14px}
.box{margin:10px;background:#151515;border-radius:14px;padding:20px;text-align:center}
.plane{font-size:42px}
.mult{font-size:36px;color:#00e676;margin-top:8px}
.timer{color:#ff4081;font-size:22px;margin-top:4px}
input,button{width:100%;padding:14px;margin-top:10px;border-radius:10px;border:none;font-size:16px}
.bet{background:#2196f3;color:#fff}
.cash{background:#e91e63;color:#fff}
.lock{opacity:.4;pointer-events:none}
.tabs{display:flex;gap:10px;margin:10px}
.tab{flex:1;background:#e91e63;padding:12px;border-radius:10px;text-align:center}
.list{font-size:14px;margin:10px}
.popup{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.popup-box{background:#1c1c1c;padding:25px;border-radius:14px;text-align:center;font-size:18px}
</style>
</head>

<body>

<div class="header">✈️ AVIATOR</div>

<div class="top">
  <div>Period: <span id="period"></span></div>
  <div>Wallet: ₹<span id="wallet"></span></div>
</div>

<div class="box">
  <div class="plane">✈️</div>
  <div class="mult" id="mult">WAIT</div>
  <div class="timer" id="timer">30s</div>

  <input id="betAmt" type="number" placeholder="Min ₹1">
  <button class="bet" id="betBtn" onclick="placeBet()">PLACE BET</button>
  <button class="cash lock" id="cashBtn" onclick="cashOut()">CASH OUT</button>
</div>

<div class="tabs">
  <div class="tab" onclick="showHistory()">Game History</div>
  <div class="tab" onclick="showBets()">My Bets</div>
</div>

<div class="box list" id="listBox">Last 10 Games</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script>
const WAIT_TIME = 30;
const BET_LOCK_TIME = 5;

let s = JSON.parse(localStorage.getItem("aviator_v2"));
if(!s){
  s={
    wallet:100,
    period:1000,
    phase:"WAIT",
    start:Date.now(),
    mult:1,
    crash:(Math.random()*3+1.5).toFixed(2),
    bets:[],
    history:[]
  };
  save();
}

function save(){localStorage.setItem("aviator_v2",JSON.stringify(s))}
function ui(){
  period.innerText=s.period;
  wallet.innerText=s.wallet;
}
ui();tick();

function tick(){
  let now=Date.now();
  let t=Math.floor((now-s.start)/1000);

  if(s.phase==="WAIT"){
    let r=WAIT_TIME-t;
    timer.innerText=r+"s";
    mult.innerText="WAIT";

    if(r<=BET_LOCK_TIME) betBtn.classList.add("lock");
    else betBtn.classList.remove("lock");

    if(r<=0){
      s.phase="FLY";
      s.start=Date.now();
      cashBtn.classList.remove("lock");
      save();
    }
  }

  if(s.phase==="FLY"){
    s.mult+=0.01;
    mult.innerText=s.mult.toFixed(2)+"x";
    timer.innerText="FLYING";

    if(s.mult>=s.crash){
      endRound();
      return;
    }
  }

  save();
  setTimeout(tick,100);
}

function placeBet(){
  let a=+betAmt.value;
  if(a<1)return popup("Min ₹1");
  if(a>s.wallet)return popup("No balance");
  if(betBtn.classList.contains("lock"))return popup("Bet Locked");

  s.wallet-=a;
  s.bets.push({amt:a,win:null});
  ui();save();
  popup("Bet Placed ₹"+a);
}

function cashOut(){
  if(s.phase!=="FLY")return;
  let b=s.bets.find(x=>x.win===null);
  if(!b)return;

  let win=Math.floor(b.amt*s.mult);
  b.win=win;
  s.wallet+=win;
  cashBtn.classList.add("lock");
  ui();save();
  popup("Win ₹"+win);
}

function endRound(){
  s.bets.forEach(b=>{if(b.win===null)b.win=0});
  s.history.unshift({p:s.period,x:s.crash});
  s.history=s.history.slice(0,10);

  s.period++;
  s.phase="WAIT";
  s.start=Date.now();
  s.mult=1;
  s.crash=(Math.random()*3+1.5).toFixed(2);
  s.bets=[];
  save();ui();
}

function showHistory(){
  listBox.innerHTML="<b>Last 10 Games</b><br>"+
  s.history.map(h=>`#${h.p} → ${h.x}x`).join("<br>");
}

function showBets(){
  listBox.innerHTML="<b>My Bets</b><br>"+
  s.history.map(h=>`Period ${h.p}`).join("<br>");
}

function popup(t){
  popupText.innerText=t;
  popup.style.display="flex";
  setTimeout(()=>popup.style.display="none",1200);
}
</script>
</body>
</html>
