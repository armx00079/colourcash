<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.header{text-align:center;padding:12px;font-size:20px;font-weight:bold}
.top{display:flex;justify-content:space-between;padding:10px 14px}
.box{
  margin:10px;
  background:#151515;
  border-radius:12px;
  padding:20px;
  text-align:center;
}
.plane{font-size:40px}
.mult{font-size:32px;color:#00e676;margin-top:10px}
input,button{
  width:100%;padding:12px;margin-top:10px;
  border-radius:8px;border:none;font-size:15px
}
button{background:#e91e63;color:#fff}
.tabs{display:flex;gap:10px;margin:10px}
.tab{flex:1;background:#e91e63;padding:10px;border-radius:8px;text-align:center}
.list{font-size:13px;margin:10px}
.lock{opacity:.4;pointer-events:none}
.popup{
  position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center
}
.popup-box{
  background:#1c1c1c;padding:20px;border-radius:12px;text-align:center
}
</style>
</head>

<body>

<div class="header">✈️ AVIATOR</div>

<div class="top">
  <div>Period: <span id="period"></span></div>
  <div>Wallet: ₹<span id="wallet"></span></div>
</div>

<div class="box">
  <div class="plane">✈️</div>
  <div class="mult" id="mult">WAIT</div>

  <input id="betAmt" type="number" placeholder="Min ₹1">
  <button id="betBtn" onclick="placeBet()">PLACE BET</button>
</div>

<div class="tabs">
  <div class="tab" onclick="showHistory()">Game History</div>
  <div class="tab" onclick="showBets()">My Bets</div>
</div>

<div class="box list" id="listBox"></div>

<div class="popup" id="popup">
  <div class="popup-box">
    <h3 id="popupText"></h3>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const ROUND_TIME = 30;
const BET_LOCK = 5;

/* ================= STATE ================= */
let state = JSON.parse(localStorage.getItem("aviator_state"));

if(!state){
  state = {
    wallet:100,
    period:1001,
    history:[],
    bets:[],
    roundStart:Date.now(),
    phase:"WAIT"
  };
  save();
}

/* ================= INIT ================= */
updateUI();
tick();

/* ================= FUNCTIONS ================= */
function save(){
  localStorage.setItem("aviator_state",JSON.stringify(state));
}

function updateUI(){
  period.innerText = state.period;
  wallet.innerText = state.wallet;
}

function tick(){
  const now = Date.now();
  const elapsed = Math.floor((now - state.roundStart)/1000);
  const remain = ROUND_TIME - elapsed;

  if(remain <= 0){
    endRound();
    return;
  }

  if(remain <= BET_LOCK){
    betBtn.classList.add("lock");
    mult.innerText = "BET LOCKED";
  }else{
    betBtn.classList.remove("lock");
    mult.innerText = "WAIT";
  }

  setTimeout(tick,1000);
}

function endRound(){
  const crash = (Math.random()*4 + 1).toFixed(2);

  state.history.unshift({
    period:state.period,
    crash:crash+"x"
  });
  state.history = state.history.slice(0,10);

  state.bets.forEach(b=>{
    if(crash >= b.cash){
      const win = Math.floor(b.amount * b.cash);
      state.wallet += win;
      b.result = "+₹"+win;
    }else{
      state.wallet -= b.amount;
      b.result = "-₹"+b.amount;
    }
  });

  state.bets = [];
  state.period++;
  state.roundStart = Date.now();

  save();
  updateUI();
  tick();
}

function placeBet(){
  const amt = Number(betAmt.value);
  if(amt < 1) return popup("Min bet ₹1");
  if(betBtn.classList.contains("lock")) return popup("Bet locked");

  state.bets.push({
    amount:amt,
    cash:2,
    result:"PENDING"
  });

  save();
  popup("Bet Placed ₹"+amt);
}

function showHistory(){
  listBox.innerHTML =
    "<b>Last 10 Games</b><br>" +
    state.history.map(h=>`#${h.period} → ${h.crash}`).join("<br>");
}

function showBets(){
  listBox.innerHTML =
    "<b>My Bets</b><br>" +
    state.bets.map(b=>`${b.result}`).join("<br>");
}

function popup(txt){
  popupText.innerText = txt;
  popup.style.display="flex";
  setTimeout(()=>popup.style.display="none",1500);
}
</script>

</body>
</html>
