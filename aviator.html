<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.header{padding:12px;text-align:center;font-size:20px;font-weight:bold}
.top{display:flex;justify-content:space-between;padding:10px 14px;font-size:14px}
.game{padding:10px}
.plane-box{
  height:180px;
  background:#151515;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:34px;
  font-weight:bold;
}
.blur{filter:blur(3px);pointer-events:none}
.controls{display:flex;gap:10px;margin-top:10px}
input,button{
  flex:1;
  padding:12px;
  border-radius:8px;
  border:none;
  font-size:15px;
}
button{background:#e91e63;color:#fff}
.history,.mybets{
  margin-top:12px;
  background:#151515;
  border-radius:12px;
  padding:10px;
}
.tab-btns{display:flex;gap:10px}
.tab-btn{
  flex:1;
  background:#e91e63;
  padding:8px;
  border-radius:8px;
  text-align:center;
  cursor:pointer;
}
.list{font-size:13px;margin-top:6px}
.popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center
}
.popup-box{
  background:#1c1c1c;
  padding:20px;
  border-radius:12px;
  text-align:center;
}
</style>
</head>

<body>

<div class="header">✈️ AVIATOR</div>

<div class="top">
  <div>Period: <span id="period">-</span></div>
  <div>Wallet: ₹<span id="wallet">0</span></div>
</div>

<div class="game">
  <div id="planeBox" class="plane-box">WAIT</div>

  <div class="controls">
    <input id="betAmt" type="number" placeholder="Min ₹1">
    <button onclick="placeBet()">BET</button>
  </div>

  <div class="tab-btns">
    <div class="tab-btn" onclick="showHistory()">Game History</div>
    <div class="tab-btn" onclick="showBets()">My Bets</div>
  </div>

  <div class="history" id="historyBox" style="display:none"></div>
  <div class="mybets" id="betsBox" style="display:none"></div>
</div>

<div class="popup" id="popup">
  <div class="popup-box">
    <h3 id="popupText"></h3>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const ROUND_TIME = 30;
const BET_LOCK_TIME = 5;

/* ---------- STATE ---------- */
let wallet = Number(localStorage.getItem("aviator_wallet")||100);
let period = Number(localStorage.getItem("aviator_period")||137);
let history = JSON.parse(localStorage.getItem("aviator_history")||"[]");
let bets = [];
let roundStart = Number(localStorage.getItem("aviator_round_start"));

/* ---------- INIT ---------- */
if(!roundStart){
  roundStart = Date.now();
  localStorage.setItem("aviator_round_start",roundStart);
}

updateUI();
runRound();

/* ---------- FUNCTIONS ---------- */
function updateUI(){
  walletSpan.innerText = wallet;
  periodSpan.innerText = period;
}

function runRound(){
  const now = Date.now();
  const elapsed = Math.floor((now - roundStart)/1000);
  const remain = ROUND_TIME - elapsed;

  if(remain <= 0){
    endRound();
    return;
  }

  if(remain <= BET_LOCK_TIME){
    planeBox.classList.add("blur");
  }else{
    planeBox.classList.remove("blur");
  }

  planeBox.innerText = remain > BET_LOCK_TIME ? "READY" : "LOCKED";
  setTimeout(runRound,1000);
}

function endRound(){
  const crash = (Math.random()*4 + 1).toFixed(2)+"x";
  history.unshift({p:period,x:crash});
  history = history.slice(0,10);

  bets.forEach(b=>{
    if(Number(crash.replace("x","")) >= b.cash){
      const win = b.amt * b.cash;
      wallet += win;
      b.result = "+₹"+win;
    }else{
      wallet -= b.amt;
      b.result = "-₹"+b.amt;
    }
  });

  localStorage.setItem("aviator_wallet",wallet);
  localStorage.setItem("aviator_history",JSON.stringify(history));

  period++;
  localStorage.setItem("aviator_period",period);

  bets=[];
  roundStart = Date.now();
  localStorage.setItem("aviator_round_start",roundStart);
  updateUI();
  runRound();
}

function placeBet(){
  const amt = Number(betAmt.value);
  if(amt < 1) return alert("Min bet ₹1");
  bets.push({amt,cash:2,result:"-"});
  showPopup("Bet Placed ₹"+amt);
}

function showHistory(){
  historyBox.style.display="block";
  betsBox.style.display="none";
  historyBox.innerHTML="<b>Last 10</b><br>"+history.map(h=>`#${h.p} → ${h.x}`).join("<br>");
}

function showBets(){
  betsBox.style.display="block";
  historyBox.style.display="none";
  betsBox.innerHTML="<b>My Bets</b><br>"+bets.map(b=>`${b.result}`).join("<br>");
}

function showPopup(txt){
  popupText.innerText=txt;
  popup.style.display="flex";
  setTimeout(()=>popup.style.display="none",1500);
}
</script>

</body>
</html>
