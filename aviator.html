<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b0b0b;
  color:#fff;
}
.header{
  padding:12px;
  text-align:center;
  background:#111;
}
.period{
  font-size:14px;
  color:#ff4081;
}
.wallet{
  font-size:15px;
  margin-top:4px;
}
.game{
  text-align:center;
  padding:20px;
}
.plane{
  font-size:48px;
  margin:20px 0;
}
.multiplier{
  font-size:36px;
  color:#00e676;
}
.controls{
  padding:15px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  font-size:16px;
}
button{
  background:#ff4081;
  color:#fff;
}
button:disabled{
  background:#555;
}
.lock{
  filter:blur(2px);
  pointer-events:none;
}
.section{
  background:#111;
  margin:12px;
  padding:12px;
  border-radius:10px;
}
.title{
  color:#ff4081;
  font-weight:bold;
  margin-bottom:8px;
}
.row{
  font-size:13px;
  border-bottom:1px solid #222;
  padding:6px 0;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#111;
  padding:20px;
  border-radius:14px;
  text-align:center;
}
.popup-box h2{
  color:#00e676;
}
</style>
</head>

<body>

<div class="header">
  <div class="period">Period: <span id="period">-</span></div>
  <div class="wallet">Wallet: ₹<span id="wallet">100</span></div>
</div>

<div class="game">
  <div class="plane">✈️</div>
  <div class="multiplier" id="multi">1.00x</div>
</div>

<div class="controls" id="betBox">
  <input type="number" id="betAmt" placeholder="Min ₹1">
  <button onclick="placeBet()">Place Bet</button>
</div>

<div class="section">
  <div class="title">Game History</div>
  <div id="history"></div>
</div>

<div class="section">
  <div class="title">My Bets</div>
  <div id="mybets"></div>
</div>

<div class="popup" id="popup">
  <div class="popup-box">
    <h2 id="popText"></h2>
    <button onclick="closePop()">OK</button>
  </div>
</div>

<script>
/* ====== STORAGE ====== */
let wallet = Number(localStorage.getItem("avi_wallet")) || 100;
let period = Number(localStorage.getItem("avi_period")) || 1000;
let history = JSON.parse(localStorage.getItem("avi_history")) || [];
let mybets = JSON.parse(localStorage.getItem("avi_bets")) || [];

/* ====== STATE ====== */
let bet = null;
let multiplier = 1;
let running = false;
let timer;

/* ====== INIT ====== */
updateUI();
startRound();

/* ====== FUNCTIONS ====== */
function startRound(){
  running = true;
  multiplier = 1;
  period++;
  localStorage.setItem("avi_period",period);
  document.getElementById("period").innerText = period;
  document.getElementById("multi").innerText = "1.00x";
  document.getElementById("betBox").classList.remove("lock");

  let lockTime = setTimeout(()=>{
    document.getElementById("betBox").classList.add("lock");
  },25000);

  let crashX = (Math.random()*3 + 1).toFixed(2);

  timer = setInterval(()=>{
    multiplier += 0.05;
    document.getElementById("multi").innerText = multiplier.toFixed(2)+"x";
    if(multiplier >= crashX){
      clearInterval(timer);
      endRound(crashX);
      clearTimeout(lockTime);
    }
  },100);
}

function placeBet(){
  let amt = Number(betAmt.value);
  if(amt < 1) return alert("Min bet ₹1");
  if(amt > wallet) return alert("Low balance");
  bet = amt;
}

function endRound(crashX){
  running = false;
  history.unshift({period,crashX});
  if(history.length>10) history.pop();

  if(bet){
    if(multiplier < crashX){
      let win = bet * multiplier;
      wallet += win;
      mybets.unshift(`+₹${win.toFixed(2)} (Win)`);
      showPop("You Won ₹"+win.toFixed(2));
    }else{
      wallet -= bet;
      mybets.unshift(`-₹${bet} (Loss)`);
      showPop("You Lost ₹"+bet);
    }
  }

  saveAll();
  updateUI();
  bet = null;
  setTimeout(startRound,3000);
}

function updateUI(){
  walletSpan.innerText = wallet.toFixed(2);
  historyBox.innerHTML = history.map(h=>`<div class="row">${h.period} → ${h.crashX}x</div>`).join("");
  mybetsBox.innerHTML = mybets.slice(0,10).map(b=>`<div class="row">${b}</div>`).join("");
}

function saveAll(){
  localStorage.setItem("avi_wallet",wallet);
  localStorage.setItem("avi_history",JSON.stringify(history));
  localStorage.setItem("avi_bets",JSON.stringify(mybets));
}

function showPop(t){
  popText.innerText = t;
  popup.style.display="flex";
}
function closePop(){
  popup.style.display="none";
}

/* ====== ELEMENTS ====== */
const walletSpan = document.getElementById("wallet");
const historyBox = document.getElementById("history");
const mybetsBox = document.getElementById("mybets");
const popup = document.getElementById("popup");
const popText = document.getElementById("popText");
</script>

</body>
</html>
