<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:#fff;
  text-align:center;
}
.card{
  background:#1c1c1c;
  margin:15px;
  padding:20px;
  border-radius:16px;
}
.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  margin-top:10px;
}
.bet{background:#2196f3;color:#fff;}
.cash{background:#e91e63;color:#fff;}
.pink{background:#ff4081;color:#fff;}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  font-size:16px;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup div{
  background:#222;
  padding:20px;
  border-radius:14px;
}
</style>
</head>

<body>

<h2>‚úàÔ∏è AVIATOR</h2>

<div class="card">
  <div id="top"></div>
  <div id="state" style="font-size:28px;color:#00e676">WAIT</div>
  <div id="timer" style="color:#ff4081;font-size:22px"></div>
  <div id="multiplier" style="font-size:34px;color:#00e676">1.00x</div>
</div>

<div class="card">
  <input id="amount" type="number" min="1" placeholder="Min ‚Çπ1">
  <button class="btn bet" onclick="placeBet()">PLACE BET</button>
  <button class="btn cash" onclick="cashOut()">CASH OUT</button>
</div>

<div class="card">
  <button class="btn pink" onclick="toggle('history')">Game History</button>
  <button class="btn pink" onclick="toggle('bets')">My Bets</button>
</div>

<div class="card" id="history" style="display:none">
  <h3>Last 10 Games</h3>
  <div id="historyList"></div>
</div>

<div class="card" id="bets" style="display:none">
  <h3>My Bets</h3>
  <div id="betsList"></div>
</div>

<div class="popup" id="popup">
  <div id="popupText"></div>
</div>

<script>
/* ====== STORAGE ====== */
let wallet = Number(localStorage.wallet ?? 100);
let period = Number(localStorage.period ?? 1000);
let history = JSON.parse(localStorage.history ?? "[]");
let bets = JSON.parse(localStorage.bets ?? "[]");

/* ====== STATE ====== */
let phase = "WAIT";
let time = 30;
let multiplier = 1;
let bet = null;
let crashAt = (Math.random()*4+1).toFixed(2);
let interval;

/* ====== UI ====== */
function render(){
  document.getElementById("top").innerText =
    `Period: ${period} | Wallet: ‚Çπ${wallet}`;
  document.getElementById("state").innerText = phase;
  document.getElementById("timer").innerText =
    phase==="WAIT"?`${time}s`:"";
  document.getElementById("multiplier").innerText =
    multiplier.toFixed(2)+"x";
  localStorage.wallet = wallet;
  localStorage.period = period;
  localStorage.history = JSON.stringify(history);
  localStorage.bets = JSON.stringify(bets);
  document.getElementById("historyList").innerHTML =
    history.map(h=>`#${h.p} ‚Üí ${h.x}x`).join("<br>");
  document.getElementById("betsList").innerHTML =
    bets.map(b=>`#${b.p} ‚Çπ${b.a} ${b.r} @${b.x}`).join("<br>");
}

/* ====== POPUP ====== */
function pop(msg){
  let p=document.getElementById("popup");
  document.getElementById("popupText").innerHTML=msg;
  p.style.display="flex";
  setTimeout(()=>p.style.display="none",1500);
}

/* ====== GAME LOOP ====== */
function startRound(){
  phase="WAIT";
  time=30;
  multiplier=1;
  bet=null;
  crashAt=(Math.random()*4+1).toFixed(2);
  clearInterval(interval);
  interval=setInterval(()=>{
    time--;
    if(time===5) phase="LOCKED";
    if(time<=0){
      clearInterval(interval);
      fly();
    }
    render();
  },1000);
}

function fly(){
  phase="FLYING";
  interval=setInterval(()=>{
    multiplier+=0.02;
    if(multiplier>=crashAt){
      crash();
    }
    render();
  },100);
}

function crash(){
  clearInterval(interval);
  phase="CRASHED";
  pop("üí• CRASH @ "+multiplier.toFixed(2)+"x");
  history.unshift({p:period,x:multiplier.toFixed(2)});
  history=history.slice(0,10);
  if(bet){
    bets.unshift({
      p:period,a:bet.a,x:multiplier.toFixed(2),
      r:"LOSS"
    });
    bets=bets.slice(0,10);
  }
  period++;
  setTimeout(startRound,2000);
}

/* ====== BET ====== */
function placeBet(){
  if(phase!=="WAIT" && phase!=="LOCKED") return;
  let a=Number(amount.value);
  if(a<1 || a>wallet) return pop("Minimum ‚Çπ1");
  wallet-=a;
  bet={a:a};
  pop("Bet Placed ‚Çπ"+a);
  render();
}

function cashOut(){
  if(!bet||phase!=="FLYING")return;
  let win=Math.floor(bet.a*multiplier);
  wallet+=win;
  bets.unshift({
    p:period,a:bet.a,x:multiplier.toFixed(2),
    r:"WIN +‚Çπ"+win
  });
  bets=bets.slice(0,10);
  bet=null;
  pop("‚úÖ WIN ‚Çπ"+win);
  render();
}

/* ====== TOGGLE ====== */
function toggle(id){
  let e=document.getElementById(id);
  e.style.display=e.style.display==="none"?"block":"none";
}

/* ====== START ====== */
render();
startRound();
</script>

</body>
</html>
