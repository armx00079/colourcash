<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Aviator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.header{text-align:center;padding:12px;font-size:22px;font-weight:bold}
.top{display:flex;justify-content:space-between;padding:10px 14px}
.box{margin:10px;background:#151515;border-radius:14px;padding:20px;text-align:center}
.plane{font-size:42px}
.mult{font-size:36px;color:#00e676;margin-top:8px}
.timer{color:#ff4081;font-size:22px;margin-top:4px}
input,button{width:100%;padding:14px;margin-top:10px;border-radius:10px;border:none;font-size:16px}
.bet{background:#2196f3;color:#fff}
.cash{background:#e91e63;color:#fff}
.lock{opacity:.4;pointer-events:none}
.tabs{display:flex;gap:10px;margin:10px}
.tab{flex:1;background:#e91e63;padding:12px;border-radius:10px;text-align:center}
.list{font-size:14px;margin:10px}
.popup{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.popup-box{background:#1c1c1c;padding:25px;border-radius:14px;text-align:center;font-size:18px}
</style>
</head>

<body>

<div class="header">‚úàÔ∏è AVIATOR</div>

<div class="top">
  <div>Period: <span id="period"></span></div>
  <div>Wallet: ‚Çπ<span id="wallet"></span></div>
</div>

<div class="box">
  <div class="plane">‚úàÔ∏è</div>
  <div class="mult" id="mult">WAIT</div>
  <div class="timer" id="timer">30s</div>

  <input id="betAmt" type="number" placeholder="Min ‚Çπ1">
  <button class="bet" id="betBtn" onclick="placeBet()">PLACE BET</button>
  <button class="cash lock" id="cashBtn" onclick="cashOut()">CASH OUT</button>
</div>

<div class="tabs">
  <div class="tab" onclick="showHistory()">Game History</div>
  <div class="tab" onclick="showBets()">My Bets</div>
</div>

<div class="box list" id="listBox">Last 10 Games</div>

<div class="popup" id="popup">
  <div class="popup-box" id="popupText"></div>
</div>

<script>
const WAIT_TIME = 30;
const BET_LOCK = 5;

let state = JSON.parse(localStorage.getItem("aviator_final"));

if (!state) {
  state = {
    wallet: 100,
    period: 1000,
    phase: "WAIT",
    start: Date.now(),
    multiplier: 1,
    crash: genCrash(),
    bets: [],
    history: []
  };
  save();
}

function genCrash() {
  return +(Math.random() * 3 + 1.2).toFixed(2);
}

function save() {
  localStorage.setItem("aviator_final", JSON.stringify(state));
}

function popup(msg) {
  popupText.innerHTML = msg;
  popupBox.style.display = "flex";
  setTimeout(() => popupBox.style.display = "none", 1500);
}

function updateUI() {
  period.innerText = state.period;
  wallet.innerText = state.wallet;
}

updateUI();
loop();

function loop() {
  let now = Date.now();
  let elapsed = Math.floor((now - state.start) / 1000);

  if (state.phase === "WAIT") {
    let remain = WAIT_TIME - elapsed;
    timer.innerText = remain + "s";
    mult.innerText = "WAIT";

    betBtn.disabled = remain <= BET_LOCK;

    if (remain <= 0) {
      state.phase = "FLY";
      state.start = Date.now();
      cashBtn.disabled = false;
      popup("‚úàÔ∏è Plane Flying");
      save();
    }
  }

  if (state.phase === "FLY") {
    state.multiplier += 0.01;
    mult.innerText = state.multiplier.toFixed(2) + "x";
    timer.innerText = "FLYING";

    if (state.multiplier >= state.crash) {
      crashRound();
      return;
    }
  }

  save();
  setTimeout(loop, 100);
}

function placeBet() {
  let amt = +betAmt.value;
  if (amt < 1) return popup("Min ‚Çπ1");
  if (amt > state.wallet) return popup("Low Balance");
  if (state.phase !== "WAIT") return popup("Bet Locked");

  state.wallet -= amt;
  state.bets.push({
    period: state.period,
    amount: amt,
    cashedAt: null,
    win: null
  });

  popup("Bet Placed ‚Çπ" + amt);
  updateUI();
  save();
}

function cashOut() {
  if (state.phase !== "FLY") return;

  let bet = state.bets.find(b => b.win === null);
  if (!bet) return;

  let payout = Math.floor(bet.amount * state.multiplier);
  bet.cashedAt = state.multiplier.toFixed(2);
  bet.win = payout;

  state.wallet += payout;
  popup(`‚úÖ Win ‚Çπ${payout} @ ${bet.cashedAt}x`);
  cashBtn.disabled = true;

  updateUI();
  save();
}

function crashRound() {
  popup(`üí• Crashed @ ${state.crash}x`);

  state.bets.forEach(b => {
    if (b.win === null) {
      b.win = 0;
      b.cashedAt = "CRASH";
    }
  });

  state.history.unshift({
    period: state.period,
    crash: state.crash
  });
  state.history = state.history.slice(0, 10);

  setTimeout(nextRound, 1200);
}

function nextRound() {
  state.period++;
  state.phase = "WAIT";
  state.start = Date.now();
  state.multiplier = 1;
  state.crash = genCrash();
  state.bets = [];
  cashBtn.disabled = true;

  updateHistory();
  save();
}

function updateHistory() {
  historyBox.innerHTML = "<b>Last 10 Games</b><br>" +
    state.history.map(h => `#${h.period} ‚Üí ${h.crash}x`).join("<br>");
}

function showMyBets() {
  historyBox.innerHTML = "<b>My Bets</b><br>" +
    state.history.map(h => {
      let bet = state.bets.find(b => b.period === h.period);
      if (!bet) return "";
      return `#${bet.period} | ‚Çπ${bet.amount} | ${bet.cashedAt} | ‚Çπ${bet.win}`;
    }).join("<br>");
}
    </script>
