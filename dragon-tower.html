<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dragon Tower</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b1220;
  color:#fff;
  text-align:center;
}
.header{
  padding:14px;
  font-size:22px;
  font-weight:bold;
}
.top-bar{
  display:flex;
  justify-content:space-between;
  padding:10px 14px;
  align-items:center;
}
#wallet{
  background:#000;
  padding:8px 14px;
  border-radius:20px;
  font-weight:bold;
}

/* MODES */
.modes{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px;
}
.mode{
  padding:8px 14px;
  border-radius:18px;
  background:#222;
  cursor:pointer;
  opacity:.6;
}
.mode.active{
  background:#22c55e;
  color:#000;
  opacity:1;
  font-weight:bold;
}

/* GRID */
.grid{
  width:260px;
  margin:14px auto;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.box{
  height:60px;
  border-radius:10px;
  background:#1e293b;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
}
.box.open.safe{background:#22c55e;color:#000}
.box.open.bomb{background:#dc2626}

/* INFO */
.info{
  margin:10px;
  font-size:16px;
}
.bet-row{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px;
}
.btn{
  background:#111;
  padding:12px 18px;
  border-radius:20px;
  cursor:pointer;
}
.bet{
  background:#111;
  padding:12px 22px;
  border-radius:20px;
}
.cashout{
  margin:10px;
  padding:14px 60px;
  background:#22c55e;
  color:#000;
  border-radius:28px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}

/* LIVE FEED */
.feed{
  margin:14px auto;
  width:90%;
  max-width:320px;
  height:110px;
  overflow:hidden;
  background:#020617;
  border-radius:14px;
  padding:10px;
  font-size:13px;
}
.feed div{padding:4px 0;opacity:.85}

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#fff;
  color:#000;
  padding:30px 50px;
  border-radius:20px;
  font-size:26px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">üêâ DRAGON TOWER</div>

<div class="top-bar">
  <div>Mode</div>
  <div id="wallet">üí∞ ‚Çπ<span id="bal">0</span></div>
</div>

<div class="modes">
  <div class="mode active" data-risk="easy">Easy</div>
  <div class="mode" data-risk="medium">Medium</div>
  <div class="mode" data-risk="hard">Hard</div>
  <div class="mode" data-risk="expert">Expert</div>
  <div class="mode" data-risk="master">Master</div>
</div>

<div class="info">
 Multiplier: <b id="multi">1.20x</b>
</div>

<div class="grid" id="grid"></div>

<div class="bet-row">
 <div class="btn" id="minus">-</div>
 <div class="bet" id="bet">Bet ‚Çπ10</div>
 <div class="btn" id="plus">+</div>
</div>

<div class="cashout" id="cashout">CASHOUT</div>

<div class="feed" id="feed"></div>

<div class="popup" id="popup">
 <div class="popup-box" id="popupBox"></div>
</div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
 getFirestore, collection, query, where, getDocs, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE CONFIG (FIXED) */
const app = initializeApp({
 apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
 authDomain:"colourcash-ea60e.firebaseapp.com",
 projectId:"colourcash-ea60e",
 storageBucket:"colourcash-ea60e.firebasestorage.app",
 messagingSenderId:"403688058646",
 appId:"1:403688058646:web:f1753360471528f275ea37"
});
const db=getFirestore(app);

/* WALLET (EMAIL BASED) */
const email=localStorage.getItem("userEmail");
let uid="",balance=0;
const bal=document.getElementById("bal");

async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
  uid=d.id;
  balance=Number(d.data().balance||0);
 });
 bal.innerText=balance;
}
loadWallet();

/* GAME */
let bet=10;
let step=0;
let opened=true;
let risk="easy";

const risks={
 easy:{bombs:1,m:[1.2,1.5,1.9,2.4,3]},
 medium:{bombs:1,m:[1.3,1.7,2.3,3.1,4.2]},
 hard:{bombs:2,m:[1.5,2.2,3.1,4.5,6.5]},
 expert:{bombs:2,m:[1.8,2.9,4.6,7.2,11]},
 master:{bombs:3,m:[2.2,3.8,6.8,12,20]}
};

const grid=document.getElementById("grid");
const multi=document.getElementById("multi");

function buildRow(){
 grid.innerHTML="";
 opened=true;
 let safe=3-risks[risk].bombs;
 let arr=[...Array(safe).fill("safe"),...Array(risks[risk].bombs).fill("bomb")]
 arr.sort(()=>Math.random()-.5);
 arr.forEach(t=>{
  const d=document.createElement("div");
  d.className="box";
  d.onclick=()=>openBox(d,t);
  grid.appendChild(d);
 });
 multi.innerText=risks[risk].m[step].toFixed(2)+"x";
}
buildRow();

function openBox(el,type){
 if(!opened)return;
 opened=false;
 el.classList.add("open",type);
 el.innerText=type==="safe"?"üíé":"üêâ";
 if(type==="safe"){
  step++;
  if(step<5)setTimeout(buildRow,600);
 }else{
  showPopup("YOU LOSE ‚ùå");
  reset();
 }
}

cashout.onclick=async ()=>{
 if(step===0)return;
 const win=Math.floor(bet*risks[risk].m[step-1]);
 balance+=win;
 bal.innerText=balance;
 await updateDoc(doc(db,"users",uid),{balance});
 showPopup("WIN ‚Çπ"+win);
 reset();
};

function reset(){
 step=0;
 setTimeout(buildRow,800);
}

/* BET */
minus.onclick=()=>{if(bet>10){bet-=10;bet.innerText="Bet ‚Çπ"+bet}}
plus.onclick=()=>{bet+=10;bet.innerText="Bet ‚Çπ"+bet}

/* MODES */
document.querySelectorAll(".mode").forEach(m=>{
 m.onclick=()=>{
  document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
  m.classList.add("active");
  risk=m.dataset.risk;
  reset();
 };
});

/* POPUP */
function showPopup(t){
 popup.style.display="flex";
 popupBox.innerText=t;
 setTimeout(()=>popup.style.display="none",2000);
}

/* FAKE LIVE FEED */
const feed=document.getElementById("feed");
setInterval(()=>{
 const amt=[850,1200,3500,7800,12500][Math.floor(Math.random()*5)];
 const d=document.createElement("div");
 d.innerText="User won ‚Çπ"+amt;
 feed.prepend(d);
 if(feed.children.length>6)feed.removeChild(feed.lastChild);
},1000);
</script>

</body>
  </html>
