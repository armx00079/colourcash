<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PLINKO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#1aa7a1,#0b6f7a);
  color:#fff;
  text-align:center;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 14px;
  font-size:20px;
  font-weight:bold;
}
.wallet{
  background:rgba(0,0,0,.35);
  padding:6px 14px;
  border-radius:20px;
  font-size:14px;
}
.history{
  margin:6px 10px;
  background:rgba(0,0,0,.25);
  padding:8px;
  border-radius:10px;
  font-size:12px;
  overflow-x:auto;
  white-space:nowrap;
}
.board{
  position:relative;
  width:320px;
  height:320px;
  margin:6px auto 0;
}
.pin{
  width:10px;
  height:10px;
  background:#fff;
  border-radius:50%;
  position:absolute;
}
.ball{
  width:14px;
  height:14px;
  background:#fff;
  border-radius:50%;
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
}
.rows{margin:0 10px;}
.row{
  display:grid;
  grid-template-columns:repeat(9,1fr);
  gap:4px;
  margin-bottom:6px;
}
.box{
  padding:6px 0;
  font-size:12px;
  border-radius:6px;
  opacity:.35;
}
.box.active{opacity:1;box-shadow:0 0 6px #fff;}
.red{background:#f44336}
.yellow{background:#ff9800}
.green{background:#4caf50}
.select{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:6px;
}
.select button{
  flex:1;
  max-width:110px;
  padding:8px 0;
  border:none;
  border-radius:20px;
  font-weight:bold;
  color:#000;
}
.controls{margin:10px;}
.bet-row{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
}
.bet{
  background:#000;
  padding:6px 18px;
  border-radius:20px;
}
.ctrl-btn{
  width:36px;
  height:36px;
  border-radius:50%;
  border:none;
  font-size:18px;
}
.drop{
  width:92%;
  padding:14px;
  margin-top:10px;
  border-radius:30px;
  background:#00c853;
  color:#000;
  font-weight:bold;
  font-size:16px;
}
</style>
</head>

<body>

<div class="header">
  <div>PLINKO</div>
  <div class="wallet">â‚¹ <span id="wallet">0</span></div>
</div>

<div class="history" id="history">Encrypted Result:</div>
<div class="board" id="board"></div>

<div class="rows">
  <div class="row">
    <div class="box red">26.3</div><div class="box red">4</div><div class="box red">1.5</div>
    <div class="box red">0.3</div><div class="box red">0.2</div>
    <div class="box red">0.3</div><div class="box red">1.5</div><div class="box red">4</div><div class="box red">26.3</div>
  </div>
  <div class="row">
    <div class="box yellow">10.5</div><div class="box yellow">3</div><div class="box yellow">1.3</div>
    <div class="box yellow">0.7</div><div class="box yellow">0.4</div>
    <div class="box yellow">0.7</div><div class="box yellow">1.3</div><div class="box yellow">3</div><div class="box yellow">10.5</div>
  </div>
  <div class="row">
    <div class="box green">5.4</div><div class="box green">1.8</div><div class="box green">1.1</div>
    <div class="box green">1</div><div class="box green">0.5</div>
    <div class="box green">1</div><div class="box green">1.1</div><div class="box green">1.8</div><div class="box green">5.4</div>
  </div>
</div>

<div class="select">
  <button class="red" id="r">RED</button>
  <button class="yellow" id="y">YELLOW</button>
  <button class="green" id="g">GREEN</button>
</div>

<div class="controls">
  <div class="bet-row">
    <button class="ctrl-btn" id="minus">âˆ’</button>
    <div class="bet">Bet â‚¹ <span id="bet">100</span></div>
    <button class="ctrl-btn" id="plus">+</button>
  </div>
  <button class="drop" id="drop">DROP BALL</button>
</div>

<!-- ðŸ”¥ðŸ”¥ðŸ”¥ EVERYTHING IN ONE MODULE (LIKE WIN GO) ðŸ”¥ðŸ”¥ðŸ”¥ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);
const userEmail = localStorage.getItem("userEmail");

/* GAME STATE */
let wallet = 0;
let bet = 100;
let color = "green";
let uid = "";

/* MULTIPLIERS */
const M = {
  red:[26.3,4,1.5,0.3,0.2,0.3,1.5,4,26.3],
  yellow:[10.5,3,1.3,0.7,0.4,0.7,1.3,3,10.5],
  green:[5.4,1.8,1.1,1,0.5,1,1.1,1.8,5.4]
};

/* LOAD WALLET (SAME AS WINGO) */
async function loadWallet(){
  const q = query(collection(db,"users"),where("email","==",userEmail));
  const snap = await getDocs(q);
  snap.forEach(d=>{
    uid=d.id;
    wallet=d.data().balance||0;
  });
  render();
}

/* SAVE WALLET */
async function saveWallet(){
  if(!uid) return;
  await updateDoc(doc(db,"users",uid),{balance:wallet});
}

/* UI */
const $=id=>document.getElementById(id);
function render(){
  $("wallet").innerText=wallet;
  $("bet").innerText=bet;
}

/* BET CONTROL */
$("plus").onclick=()=>{if(bet+10<=wallet) bet+=10; render();}
$("minus").onclick=()=>{if(bet>10) bet-=10; render();}

/* COLOR */
$("r").onclick=()=>color="red";
$("y").onclick=()=>color="yellow";
$("g").onclick=()=>color="green";

/* BOARD */
const board=$("board");
const rows=8,sx=34,sy=32,start=3;
for(let r=0;r<rows;r++){
  for(let c=0;c<start+r;c++){
    const p=document.createElement("div");
    p.className="pin";
    p.style.top=50+r*sy+"px";
    p.style.left=160-((start+r-1)*sx)/2+c*sx+"px";
    board.appendChild(p);
  }
}

/* DROP */
$("drop").onclick=()=>{
  if(bet>wallet) return alert("Low balance");
  wallet-=bet; saveWallet(); render();

  const ball=document.createElement("div");
  ball.className="ball"; board.appendChild(ball);
  let col=4,step=0;

  const fall=()=>{
    if(step<rows){
      col+=Math.random()<0.5?-1:1;
      col=Math.max(0,Math.min(col,8));
      ball.style.top=40+step*sy+"px";
      ball.style.left=col*sx+20+"px";
      step++; setTimeout(fall,220);
    }else finish(col,ball);
  };
  fall();
};

/* RESULT */
function finish(col,ball){
  const HOUSE=0.40;
  const win=Math.round(bet*M[color][col]*(1-HOUSE));
  wallet+=win; saveWallet(); render();
  $("history").innerHTML+=` | ${color.toUpperCase()} ${M[color][col]}x`;
  setTimeout(()=>ball.remove(),400);
}

loadWallet();
</script>

</body>
</html>
