<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PLINKO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#1aa7a1,#0b6f7a);color:#fff;text-align:center}
.header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;font-size:20px;font-weight:bold}
.wallet{background:rgba(0,0,0,.35);padding:6px 14px;border-radius:20px;font-size:14px}
.history{margin:6px 10px;background:rgba(0,0,0,.25);padding:8px;border-radius:10px;font-size:12px;white-space:nowrap;overflow-x:auto}
.board{position:relative;width:320px;height:320px;margin:6px auto}
.pin{width:10px;height:10px;background:#fff;border-radius:50%;position:absolute}
.ball{width:14px;height:14px;background:#fff;border-radius:50%;position:absolute;top:20px;left:50%;transform:translateX(-50%);transition:.22s linear}
.rows{margin:0 10px}
.row{display:grid;grid-template-columns:repeat(9,1fr);gap:4px;margin-bottom:6px}
.box{padding:6px 0;font-size:12px;border-radius:6px;opacity:.35}
.box.active{opacity:1;box-shadow:0 0 6px #fff}
.red{background:#f44336}.yellow{background:#ff9800}.green{background:#4caf50}
.select{display:flex;justify-content:center;gap:10px;margin-top:6px}
.select button{flex:1;max-width:110px;padding:8px;border:none;border-radius:20px;font-weight:bold}
.controls{margin:10px}
.bet-row{display:flex;justify-content:center;align-items:center;gap:10px}
.bet{background:#000;padding:6px 18px;border-radius:20px}
.ctrl-btn{width:36px;height:36px;border-radius:50%;border:none;font-size:18px}
.drop{width:92%;padding:14px;margin-top:10px;border-radius:30px;background:#00c853;color:#000;font-weight:bold;font-size:16px}
</style>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain: "colourcash-ea60e.firebaseapp.com",
  projectId: "colourcash-ea60e",
  storageBucket: "colourcash-ea60e.appspot.com",
  messagingSenderId: "403688058646",
  appId: "1:403688058646:web:f1753360471528f275ea37"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

if(!localStorage.getItem("user_id")){
  alert("User not logged in");
}

window.db = db;
window.userId = localStorage.getItem("user_id");
window.doc = doc;
window.getDoc = getDoc;
window.updateDoc = updateDoc;

window.addEventListener("load",()=>{
  if(window.loadWallet) window.loadWallet();
});
</script>
</head>

<body>

<div class="header">
  <div>PLINKO</div>
  <div class="wallet">â‚¹ <span id="wallet">0</span></div>
</div>

<div class="history" id="history">Encrypted Result:</div>
<div class="board" id="board"></div>

<div class="rows">
  <div class="row">
    <div class="box red">26.3</div><div class="box red">4</div><div class="box red">1.5</div>
    <div class="box red">0.3</div><div class="box red">0.2</div>
    <div class="box red">0.3</div><div class="box red">1.5</div><div class="box red">4</div><div class="box red">26.3</div>
  </div>
</div>

<div class="select">
  <button class="red" onclick="selectColor('red')">RED</button>
  <button class="yellow" onclick="selectColor('yellow')">YELLOW</button>
  <button class="green" onclick="selectColor('green')">GREEN</button>
</div>

<div class="controls">
  <div class="bet-row">
    <button class="ctrl-btn" onclick="bet=Math.max(10,bet-10);update()">âˆ’</button>
    <div class="bet">Bet â‚¹ <span id="bet">100</span></div>
    <button class="ctrl-btn" onclick="bet+=10;update()">+</button>
  </div>
  <button class="drop" onclick="dropBall()">DROP BALL</button>
</div>

<script>
const board=document.getElementById("board");
const walletUI=document.getElementById("wallet");
const historyBar=document.getElementById("history");

let wallet=0,bet=100,activeColor="red";

const multipliers={
  red:[26.3,4,1.5,0.3,0.2,0.3,1.5,4,26.3]
};

window.loadWallet = async function(){
  const ref = doc(db,"users",userId);
  const snap = await getDoc(ref);
  wallet = snap.data().wallet || 0;
  update();
}

async function saveWallet(){
  await updateDoc(doc(db,"users",userId),{ wallet });
}

function update(){
  walletUI.innerText = wallet;
  document.getElementById("bet").innerText = bet;
}

function selectColor(c){
  activeColor=c;
}

function dropBall(){
  if(bet>wallet) return alert("Low balance");

  wallet -= bet;
  saveWallet(); update();

  let col=Math.floor(Math.random()*9);
  let mul=multipliers[activeColor][col];
  let win=Math.round(bet*mul*0.6);

  setTimeout(()=>{
    wallet+=win;
    saveWallet(); update();
    historyBar.innerHTML+=` | WIN ${win}`;
  },1000);
}
</script>

</body>
</html>
