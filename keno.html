<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üî• KENO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:#fff;
  text-align:center;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  font-weight:bold;
}
.wallet{
  background:#1c1c1c;
  padding:6px 14px;
  border-radius:20px;
}

/* ? BUTTON */
.info-btn{
  width:28px;height:28px;
  border-radius:50%;
  border:none;
  background:#333;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(8,1fr);
  gap:8px;
  padding:14px;
}
.num{
  background:#222;
  border-radius:8px;
  padding:12px 0;
  cursor:pointer;
  font-weight:bold;
}
.num.active{background:#4caf50;color:#000}
.num.hit{background:#ffeb3b;color:#000}

/* BET */
.bet-box{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
}
.bet-box button{
  width:40px;height:40px;
  border-radius:50%;
  font-size:20px;
  border:none;
  cursor:pointer;
}
.spin-btn{
  margin:14px auto;
  width:200px;
  padding:14px;
  border-radius:40px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  font-size:20px;
  font-weight:bold;
  border:none;
  color:#fff;
  cursor:pointer;
}
.auto{margin-bottom:10px}

/* HISTORY */
.history{
  margin:14px;
  background:#1b1b1b;
  border-radius:12px;
  padding:10px;
  font-size:13px;
  text-align:left;
}
.h-row{
  display:flex;
  justify-content:space-between;
  padding:4px 0;
}
.win{color:#4caf50}
.lose{color:#ff5252}

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
.popup-box{
  background:#222;
  padding:20px;
  border-radius:16px;
  max-width:90%;
  text-align:left;
}
.popup-box h3{
  margin:0 0 10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.popup-box table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
.popup-box th,.popup-box td{
  padding:6px 4px;
  border-bottom:1px solid #333;
}
.close{
  cursor:pointer;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div>üî• KENO</div>
  <div style="display:flex;align-items:center;gap:8px">
    <button class="info-btn" id="infoBtn">?</button>
    <div class="wallet">‚Çπ <span id="wallet">0</span></div>
  </div>
</div>

<div class="grid" id="grid"></div>

<div class="bet-box">
  <button id="minus">‚àí</button>
  Bet ‚Çπ <span id="bet">10</span>
  <button id="plus">+</button>
</div>

<div class="auto">
  <label><input type="checkbox" id="auto"> Auto Play (10)</label>
</div>

<button class="spin-btn" id="spin">PLAY</button>

<div class="history">
  <b>MY BETS</b>
  <div id="history"></div>
</div>

<!-- PAYOUT POPUP -->
<div class="popup" id="infoPopup">
  <div class="popup-box">
    <h3>
      PAYOUT TABLE
      <span class="close" id="closeInfo">‚ùå</span>
    </h3>
    <table>
      <tr><th>Selected</th><th>Match</th><th>x</th></tr>
      <tr><td>1</td><td>1</td><td>2.00x</td></tr>
      <tr><td>2</td><td>2</td><td>3.80x</td></tr>
      <tr><td>3</td><td>3</td><td>5.00x</td></tr>
      <tr><td>5</td><td>4</td><td>6.00x</td></tr>
      <tr><td>5</td><td>5</td><td>15.00x</td></tr>
      <tr><td>10</td><td>7</td><td>15.00x</td></tr>
      <tr><td>10</td><td>8</td><td>50.00x</td></tr>
    </table>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, getDocs, collection, query, where, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyBx3J9aGn_98rTPgurMMKw_GR3puIMj4Ms",
  authDomain:"colourcash-ea60e.firebaseapp.com",
  projectId:"colourcash-ea60e"
});
const db = getFirestore(app);

const email = localStorage.getItem("userEmail");
let uid="", balance=0;
let firstWinDone = localStorage.getItem("kenoFirstWinDone")==="yes";

/* UI */
const walletEl=document.getElementById("wallet");
const betEl=document.getElementById("bet");
const grid=document.getElementById("grid");
const historyBox=document.getElementById("history");

/* INFO POPUP */
infoBtn.onclick=()=>infoPopup.style.display="flex";
closeInfo.onclick=()=>infoPopup.style.display="none";

/* LOAD WALLET */
async function loadWallet(){
 const q=query(collection(db,"users"),where("email","==",email));
 const snap=await getDocs(q);
 snap.forEach(d=>{
  uid=d.id;
  balance=Number(d.data().balance||0);
 });
 walletEl.innerText=balance;
}
function userRef(){return doc(db,"users",uid);}

/* NUMBERS */
let selected=[];
for(let i=1;i<=40;i++){
 const d=document.createElement("div");
 d.className="num";
 d.innerText=i;
 d.onclick=()=>{
  if(selected.includes(i)){
    selected=selected.filter(x=>x!==i);
    d.classList.remove("active");
  }else{
    if(selected.length>=10) return;
    selected.push(i);
    d.classList.add("active");
  }
 };
 grid.appendChild(d);
}

/* BET */
let bet=10;
plus.onclick=()=>{bet+=10;betEl.innerText=bet};
minus.onclick=()=>{bet=Math.max(10,bet-10);betEl.innerText=bet};

/* PAYOUT */
function payout(matches,picks){
 if(picks===1 && matches===1) return 2;
 if(picks===2 && matches===2) return 3.8;
 if(picks===3 && matches===3) return 5;
 if(picks===5 && matches===5) return 15;
 if(picks===10 && matches>=7) return [0,0,0,0,0,0,15,50][matches];
 return 0;
}

/* PLAY */
async function play(){
 if(selected.length===0) return alert("Select numbers");
 if(balance<bet) return alert("Low balance");

 balance-=bet;
 await updateDoc(userRef(),{balance});
 walletEl.innerText=balance;

 document.querySelectorAll(".num").forEach(n=>n.classList.remove("hit"));

 let drawn=[];
 while(drawn.length<10){
  let r=Math.floor(Math.random()*40)+1;
  if(!drawn.includes(r)) drawn.push(r);
 }

 let matches=selected.filter(x=>drawn.includes(x)).length;
 let win=bet*payout(matches,selected.length);

 if(!firstWinDone && win>0){
  win=Math.min(win,300);
  firstWinDone=true;
  localStorage.setItem("kenoFirstWinDone","yes");
 }

 drawn.forEach(n=>document.querySelectorAll(".num")[n-1].classList.add("hit"));

 if(win>0){
  balance+=win;
  await updateDoc(userRef(),{balance});
  historyBox.innerHTML=`<div class="h-row"><span>Hit ${matches}</span><span class="win">+‚Çπ${win}</span></div>`+historyBox.innerHTML;
 }else{
  historyBox.innerHTML=`<div class="h-row"><span>Hit ${matches}</span><span class="lose">-‚Çπ${bet}</span></div>`+historyBox.innerHTML;
 }
 walletEl.innerText=balance;
}

/* AUTO */
spin.onclick=async ()=>{
 if(auto.checked){
  for(let i=0;i<10;i++){
    await play();
    await new Promise(r=>setTimeout(r,700));
  }
 }else play();
};

loadWallet();
</script>

</body>
</html>
